{"info":{"title":"網頁圖片載入優化－懶加載（Lazy Loading）","fileName":"image-lazy-load","description":"常見圖片載入優化手段之一，一起來了解什麼是懶加載","createdAt":"2025-12-10T00:00:00.000Z","updatedAt":"2025-12-10T00:00:00.000Z","tags":["browser","image"]},"content":"<h6>tags: <code>browser</code> <code>image</code></h6>\n<h1 id=\"網頁圖片載入優化－懶加載（Lazy Loading）\" title=\"網頁圖片載入優化－懶加載（Lazy Loading）\">網頁圖片載入優化－懶加載（Lazy Loading）</h1>\n<h2 id=\"什麼是懶加載？\" title=\"什麼是懶加載？\"><a href=\"#什麼是懶加載？\">什麼是懶加載？</a></h2>\n<p>懶加載是一種常見的前端效能優化技術，概念是在<strong>需要的時候</strong>才載入資源，以提升網頁的載入速度與使用者體驗。常見應用包含圖片、影片，以及動態載入的模組或元件。本文將以圖片懶加載為主要討論對象。</p>\n<p>由於使用者螢幕的可視範圍有限，頁面初始載入時，僅先下載首屏（可視範圍內）會出現的圖片，其餘尚未進入視窗的圖片則延後載入。當使用者往下捲動頁面時，再即時載入對應的圖片資源，可有效加快首屏呈現速度。</p>\n<h3>優點</h3>\n<ul>\n<li>加快頁面載入速度，讓使用者更快看到內容</li>\n<li>提升使用者體驗（UX），降低跳出率</li>\n<li>減少不必要的流量消耗</li>\n</ul>\n<h2 id=\"何時需要使用懶加載？\" title=\"何時需要使用懶加載？\"><a href=\"#何時需要使用懶加載？\">何時需要使用懶加載？</a></h2>\n<p>通常適用於圖片數量較多的頁面，例如：列表頁、首頁或內容型網站。</p>\n<h2 id=\"常見實作方式\" title=\"常見實作方式\"><a href=\"#常見實作方式\">常見實作方式</a></h2>\n<h3>Image HTML Tag</h3>\n<p>原生 HTML 的 <code>&lt;img&gt;</code> 元素已支援圖片懶加載，只要透過設定 <code>loading=&quot;lazy&quot;</code> 屬性，即可指示瀏覽器延後載入圖片。</p>\n<p>此方式適合簡單的使用情境；但若需要更細緻的載入控制（例如：提早載入、搭配動畫效果），則需搭配 JavaScript 進一步實作。</p>\n<blockquote>\n<p><a  href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/img#loading\" target=\"_blank\" rel=\"noreferrer noopener\">MDN - </a><code>[&lt;img&gt; ](https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/img#loading)</code><a  href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/img#loading\" target=\"_blank\" rel=\"noreferrer noopener\">loading lazy</a></p>\n</blockquote>\n<pre class=\"hljs\"><code><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">loading</span>=<span class=\"hljs-string\">&quot;lazy&quot;</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;swing-400.jpg&quot;</span> <span class=\"hljs-attr\">alt</span>=<span class=\"hljs-string\">&quot;Kettlebell Swing&quot;</span> /&gt;</span>\n</code></pre>\n<h3>監聽 Scroll Event</h3>\n<p>監聽 <code>scroll</code> 事件，並在每次捲動時檢查圖片是否進入可視範圍；若符合條件，就把 <code>data-src</code> 指定給 <code>src</code> 觸發圖片載入。</p>\n<pre class=\"hljs\"><code><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">data-src</span>=<span class=\"hljs-string\">&quot;1.png&quot;</span> <span class=\"hljs-attr\">alt</span>=<span class=\"hljs-string\">&quot;image 1&quot;</span> /&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">data-src</span>=<span class=\"hljs-string\">&quot;2.png&quot;</span> <span class=\"hljs-attr\">alt</span>=<span class=\"hljs-string\">&quot;image 2&quot;</span> /&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">data-src</span>=<span class=\"hljs-string\">&quot;3.png&quot;</span> <span class=\"hljs-attr\">alt</span>=<span class=\"hljs-string\">&quot;image 3&quot;</span> /&gt;</span>\n  ... ...\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n</code></pre>\n<pre class=\"hljs\"><code><span class=\"hljs-keyword\">const</span> images = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelectorAll</span>(<span class=\"hljs-string\">&quot;img&quot;</span>);\n\n<span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&quot;scroll&quot;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> {\n  images.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">image</span>) =&gt;</span> {\n    <span class=\"hljs-keyword\">const</span> imageTop = image.<span class=\"hljs-title function_\">getBoundingClientRect</span>().<span class=\"hljs-property\">top</span>;\n\n    <span class=\"hljs-comment\">// 若希望「提早載入」，可以加上 offset，例如：window.innerHeight + 100</span>\n    <span class=\"hljs-keyword\">if</span> (imageTop &lt; <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">innerHeight</span>) {\n      <span class=\"hljs-keyword\">const</span> data_src = image.<span class=\"hljs-title function_\">getAttribute</span>(<span class=\"hljs-string\">&quot;data-src&quot;</span>);\n      image.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&quot;src&quot;</span>, data_src);\n    }\n  });\n});\n</code></pre>\n<h4>缺點</h4>\n<ol>\n<li><strong>需要自行計算可視範圍</strong>：寫法相對不直覺；若要做「提早載入」還得加入 offset 計算，降低可讀性。</li>\n<li><strong>scroll 觸發頻繁</strong>：即使圖片已載入，捲動時仍會一直跑迴圈檢查。</li>\n<li><strong>圖片數量多時成本更高</strong>：每次捲動都遍歷所有圖片，容易造成主執行緒負擔增加，影響捲動流暢度。</li>\n</ol>\n<p>⇒ 會更推薦使用原生的 <a  href=\"https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver\" target=\"_blank\" rel=\"noreferrer noopener\">InterSection Observer </a></p>\n<h3>InterSection Observer</h3>\n<p>Intersection Observer 是瀏覽器提供的 Web API，可用來觀察目標元素與可視視窗之間是否產生交集，並在進入或離開可視範圍時執行對應的邏輯。</p>\n<p>相較於自行監聽 <code>scroll</code> 事件並計算元素位置，使用方式更直覺且效能友善，瀏覽器會在適當時機觸發 callback，且目前主流瀏覽器都支援。</p>\n<h4>基本用法</h4>\n<p><code>IntersectionObserver</code> 建立時會接收兩個參數：：</p>\n<ul>\n<li><strong>callback</strong> - 當觀察目標進入或離開可視範圍時，會觸發 callback，用來處理對應的邏輯。</li>\n<li><strong>options</strong>\n<ul>\n<li><code>root</code>：用來決定「以誰的視角」來觀察元素是否進入可視範圍，預設為 <code>null</code>，代表以瀏覽器視窗（viewport）作為觀察範圍。</li>\n<li><code>rootMargin</code>：用來控制「提早或延後多久」才算進入可視範圍，常用於預先載入圖片。</li>\n<li><code>threshold</code>：用來決定「元素露出多少比例時」才觸發 callback。</li>\n</ul>\n</li>\n</ul>\n<pre class=\"hljs\"><code><span class=\"hljs-keyword\">const</span> observer = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">IntersectionObserver</span>(callback, {\n  <span class=\"hljs-comment\">// 圖片距離視窗 200px 時開始進入觀察範圍，</span>\n  <span class=\"hljs-comment\">// 且圖片實際顯示超過 25% 時，才會觸發 callback</span>\n  <span class=\"hljs-attr\">root</span>: <span class=\"hljs-literal\">null</span>,\n  <span class=\"hljs-attr\">rootMargin</span>: <span class=\"hljs-string\">&quot;200px 0px&quot;</span>,\n  <span class=\"hljs-attr\">threshold</span>: <span class=\"hljs-number\">0.25</span>\n});\n\n<span class=\"hljs-comment\">// 開始觀察指定 DOM 元素</span>\nobserver.<span class=\"hljs-title function_\">observe</span>(domNode);\n\n<span class=\"hljs-comment\">// 取消觀察指定 DOM 元素</span>\nobserver.<span class=\"hljs-title function_\">unobserve</span>(domNode);\n</code></pre>\n<h4>應用</h4>\n<pre class=\"hljs\"><code><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">data-src</span>=<span class=\"hljs-string\">&quot;1.png&quot;</span> <span class=\"hljs-attr\">alt</span>=<span class=\"hljs-string\">&quot;image 1&quot;</span> /&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">data-src</span>=<span class=\"hljs-string\">&quot;2.png&quot;</span> <span class=\"hljs-attr\">alt</span>=<span class=\"hljs-string\">&quot;image 2&quot;</span> /&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">data-src</span>=<span class=\"hljs-string\">&quot;3.png&quot;</span> <span class=\"hljs-attr\">alt</span>=<span class=\"hljs-string\">&quot;image 3&quot;</span> /&gt;</span>\n  ... ...\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n</code></pre>\n<pre class=\"hljs\"><code><span class=\"hljs-keyword\">const</span> images = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">querySelectorAll</span>(<span class=\"hljs-string\">&quot;img&quot;</span>);\n\n<span class=\"hljs-keyword\">const</span> observer = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">IntersectionObserver</span>(\n  <span class=\"hljs-function\">(<span class=\"hljs-params\">entries, observer</span>) =&gt;</span> {\n    entries.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">entry</span>) =&gt;</span> {\n      <span class=\"hljs-comment\">// 元素進入可視範圍</span>\n      <span class=\"hljs-keyword\">if</span> (entry.<span class=\"hljs-property\">isIntersecting</span>) {\n        <span class=\"hljs-comment\">// 目標元素</span>\n        <span class=\"hljs-keyword\">const</span> img = entry.<span class=\"hljs-property\">target</span>;\n        <span class=\"hljs-keyword\">const</span> dataSrc = img.<span class=\"hljs-title function_\">getAttribute</span>(<span class=\"hljs-string\">&quot;data-src&quot;</span>);\n\n        <span class=\"hljs-keyword\">if</span> (dataSrc) {\n          img.<span class=\"hljs-title function_\">setAttribute</span>(<span class=\"hljs-string\">&quot;src&quot;</span>, dataSrc);\n          <span class=\"hljs-comment\">// 圖片載入後停止觀察，避免重複觸發</span>\n          observer.<span class=\"hljs-title function_\">unobserve</span>(img);\n        }\n      }\n    });\n  },\n  {\n    <span class=\"hljs-comment\">// 可視範圍外提前載入（預載）</span>\n    <span class=\"hljs-attr\">rootMargin</span>: <span class=\"hljs-string\">&quot;100px 0px&quot;</span>\n  }\n);\n\nimages.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">img</span>) =&gt;</span> observer.<span class=\"hljs-title function_\">observe</span>(img));\n</code></pre>\n<blockquote>\n<p>[補充] Intersection Observer 除了圖片懶加載，也適合用於無限捲動、曝光追蹤等情境。</p>\n</blockquote>\n<h3>第三方套件</h3>\n<ul>\n<li>react-lazyload</li>\n<li>vue-lazyload</li>\n</ul>\n<h2 id=\"LCP / CLS 注意事項\" title=\"LCP / CLS 注意事項\"><a href=\"#LCP / CLS 注意事項\">LCP / CLS 注意事項</a></h2>\n<h3>1. 首屏圖片不建議使用懶加載</h3>\n<p>懶加載可能會延後圖片實際下載時機，進而影響 LCP（Largest Contentful Paint），所以首屏的圖片建議維持優先載入(<code>&lt;img&gt;</code> 預設為 loading 為 <a  href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/img#eager\" target=\"_blank\" rel=\"noreferrer noopener\">eager</a>)。</p>\n<h3>2. 不管圖片是否有做懶加載，記得預留圖片渲染空間</h3>\n<p>無論圖片是否使用懶加載，都應預先保留圖片的顯示空間，例如設定 <code>width</code>、<code>height</code>，或使用 Loading Skeleton，以避免版面跳動，影響 CLS（Cumulative Layout Shift）。</p>\n<h2 id=\"參考資料\" title=\"參考資料\"><a href=\"#參考資料\">參考資料</a></h2>\n<ol>\n<li><a  href=\"https://www.youtube.com/watch?v=R_TqNVgD3G4\" target=\"_blank\" rel=\"noreferrer noopener\">JavaScript 图片懒加载</a></li>\n</ol>\n","toc":{"title":"網頁圖片載入優化－懶加載（Lazy Loading）","subtitles":["什麼是懶加載？","何時需要使用懶加載？","常見實作方式","LCP / CLS 注意事項","參考資料"]},"wordCount":415}