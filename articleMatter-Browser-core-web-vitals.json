{"info":{"title":"認識 Core Web Vitals","fileName":"core-web-vitals","description":"想要優化網站嗎？來認識一下 Core Web Vitals 吧！","createdAt":"2024-05-17T00:00:00.000Z","updatedAt":"2024-05-17T00:00:00.000Z","tags":["core-web-vitals","LCP","CLS","FID","INP"]},"content":"<h6>tags: <code>core-web-vitals</code>、<code>LCP</code>、<code>CLS</code>、<code>FID</code>、<code>INP</code></h6>\n<h1 id=\"認識 Core Web Vitals\" title=\"認識 Core Web Vitals\">認識 Core Web Vitals</h1>\n<p><img src=\"https://hackmd.io/_uploads/Sk-eHSIBT.png\" alt=\"image\" /></p>\n<h2 id=\"什麼是 Web Vitals\" title=\"什麼是 Web Vitals\"><a href=\"#什麼是 Web Vitals\">什麼是 Web Vitals</a></h2>\n<p>由 Google 定義出來的專有名詞，針對優秀的使用者體驗，提供品質指標的統整指南，主要是透過量化方式，提供工程師改善網站的方向，也是影響 SEO 排名的其中一個因素。</p>\n<p>根據網站的不同面向，Web Vitals 提供<a  href=\"https://web.dev/articles/user-centric-performance-metrics?hl=zh-tw#important_metrics_to_measure\" target=\"_blank\" rel=\"noreferrer noopener\">多個指標</a>：</p>\n<ul>\n<li>最大的內容繪製 <a  href=\"https://web.dev/articles/lcp?hl=zh-tw#what_elements_are_considered\" target=\"_blank\" rel=\"noreferrer noopener\">(LCP)</a></li>\n<li>首次輸入延遲 <a  href=\"https://web.dev/articles/fid?hl=zh-tw\" target=\"_blank\" rel=\"noreferrer noopener\">(FID)</a></li>\n<li>累計版面配置位移 <a  href=\"https://web.dev/articles/cls?hl=zh-tw\" target=\"_blank\" rel=\"noreferrer noopener\">(CLS)</a></li>\n<li>首次位元組時間 <a  href=\"https://web.dev/articles/ttfb?hl=en\" target=\"_blank\" rel=\"noreferrer noopener\">(TTFB)</a></li>\n<li>首次內容繪製 <a  href=\"https://web.dev/articles/fcp?hl=en\" target=\"_blank\" rel=\"noreferrer noopener\">(FCP)</a></li>\n<li>互動時間 <a  href=\"https://web.dev/articles/tti?hl=en\" target=\"_blank\" rel=\"noreferrer noopener\">(TTI)</a></li>\n<li>總封鎖時間 <a  href=\"https://web.dev/articles/tbt?hl=en\" target=\"_blank\" rel=\"noreferrer noopener\">(TBT)</a></li>\n<li>與下一個顯示內容的互動 <a  href=\"https://web.dev/articles/inp\" target=\"_blank\" rel=\"noreferrer noopener\">(INP)</a></li>\n</ul>\n<h2 id=\"什麼是 Core Web Vitals\" title=\"什麼是 Core Web Vitals\"><a href=\"#什麼是 Core Web Vitals\">什麼是 Core Web Vitals</a></h2>\n<p>Google 的 Chrome 團隊在 2020 年提出，用來<strong>衡量網站使用者體驗</strong>最重要的三種指標，分別代表 UX 三個不同面向：<strong>載入(Loading)</strong>、<strong>互動(Interactivity)</strong> 與 <strong>視覺穩定性(Visual Stability)</strong>。</p>\n<ul>\n<li>最大的內容繪製<a  href=\"https://web.dev/articles/lcp?hl=zh-tw#what_elements_are_considered\" target=\"_blank\" rel=\"noreferrer noopener\">(LCP)</a>：評估載入效能</li>\n<li>首次輸入延遲<a  href=\"https://web.dev/articles/fid?hl=zh-tw\" target=\"_blank\" rel=\"noreferrer noopener\">(FID)</a>：測量互動值</li>\n<li>累計版面配置位移 <a  href=\"https://web.dev/articles/cls?hl=zh-tw\" target=\"_blank\" rel=\"noreferrer noopener\">(CLS)</a>：評估視覺化內容的穩定性</li>\n</ul>\n<div class=\"info\">\n<p>💡 <strong>補充：</strong><br />\n網站體驗核心指標會隨著時間演變(指標項目或計算公式)，皆可從<a  href=\"https://web.dev/articles/vitals\" target=\"_blank\" rel=\"noreferrer noopener\">官方說明文件</a>和指標的 CHANGELOG 中取得最新變更資訊。</p>\n</div>\n<!-- https://web.dev/articles/user-centric-performance-metrics?hl=zh-tw#important_metrics_to_measure -->\n<h2 id=\"LCP - 最大內容繪製 (Largest Contentful Paint)\" title=\"LCP - 最大內容繪製 (Largest Contentful Paint)\"><a href=\"#LCP - 最大內容繪製 (Largest Contentful Paint)\">LCP - 最大內容繪製 (Largest Contentful Paint)</a></h2>\n<p><img src=\"https://hackmd.io/_uploads/BJBXmSUHT.png\" alt=\"image\" /></p>\n<p>測量使用者開始載入網頁到在 <strong>可視區域(viewport)</strong> 內顯示 <strong>最大圖片或文字區塊</strong> 之間的時間(以秒為單位)。</p>\n<ul>\n<li>評估網頁主要內容的載入速度</li>\n<li>Good: 頁面初次開始載入後的 <strong>2.5 秒內</strong>執行 👍</li>\n</ul>\n<div class=\"info\">\n<p>💡 <strong>補充：</strong></p>\n<p><strong>最大的元素會隨著內容載入而改變：</strong></p>\n<p><em>範例一</em></p>\n<p>最初的 LCP 是左上方文字，後續加載新的 DOM 後，在第五影格時候變成了圖片。</p>\n<p><img src=\"https://hackmd.io/_uploads/H11cnL8rT.png\" alt=\"image\" /></p>\n<p><em>範例二</em></p>\n<p>Instagram 標誌會相對提早載入，即使系統會逐步顯示其他內容，仍是最大的元素。</p>\n<p><img src=\"https://hackmd.io/_uploads/rkxNa8LB6.png\" alt=\"image\" /></p>\n</div>\n<h3>優化方向</h3>\n<p>任何阻礙頁面渲染的因素，都會造成 LCP 分數不佳，因此可針對以下方向做優化：</p>\n<ol>\n<li><strong>圖片載入時間</strong>\n<ul>\n<li>圖片格式 e.g. <a  href=\"https://caniuse.com/?search=webP\" target=\"_blank\" rel=\"noreferrer noopener\">WebP</a>、<a  href=\"https://caniuse.com/?search=avif\" target=\"_blank\" rel=\"noreferrer noopener\">AVIF</a></li>\n<li>CDN</li>\n<li>圖片尺寸</li>\n<li>預先載入 e.g. <code>&lt;link rel=&quot;preload&quot;&gt;</code></li>\n</ul>\n</li>\n<li><strong>外部資源載入的時間（CSS、JS、Font）</strong>\n<ul>\n<li>Lazy Loading</li>\n<li>Code Splitting</li>\n<li>Tree Shaking</li>\n</ul>\n</li>\n</ol>\n<p>大方向是針對第一幀內容越快載入越好，不需要的內容越晚下載越好。</p>\n<h2 id=\"CLS - 累積佈局偏移 (Cumulative Layout Shift)\" title=\"CLS - 累積佈局偏移 (Cumulative Layout Shift)\"><a href=\"#CLS - 累積佈局偏移 (Cumulative Layout Shift)\">CLS - 累積佈局偏移 (Cumulative Layout Shift)</a></h2>\n<p><img src=\"https://hackmd.io/_uploads/Bkeb_jIIra.png\" alt=\"image\" /></p>\n<p>評估網頁整個生命週期中每發生非預期版面配置位移：</p>\n<ul>\n<li><strong>視覺化內容的穩定性</strong></li>\n<li>Good: 頁面 CLS 應維持為 <strong>0.1 以下</strong></li>\n<li>佈局偏移分數 = 影響可視範圍比例 * 移動距離比例</li>\n</ul>\n<p><img src=\"https://hackmd.io/_uploads/rJa1433Lp.png\" alt=\"image\" /></p>\n<blockquote>\n<p>可視範圍比例 50% * 移動 25% = 0.125</p>\n</blockquote>\n<h3>優化方向</h3>\n<ol>\n<li>預先指定元素大小 (Placeholder)</li>\n<li>CSS 轉換動畫</li>\n</ol>\n<h2 id=\"FID - 首次輸入延遲時間（First Input Delay）\" title=\"FID - 首次輸入延遲時間（First Input Delay）\"><a href=\"#FID - 首次輸入延遲時間（First Input Delay）\">FID - 首次輸入延遲時間（First Input Delay）</a></h2>\n<p><img src=\"https://hackmd.io/_uploads/rkCYoIISp.png\" alt=\"image\" /></p>\n<p>測量從使用者首次與網站互動 (點選連結、輕觸按鈕等) 到瀏覽器實際能回應互動所需的時間（單位為毫秒）。</p>\n<ul>\n<li>評估互動</li>\n<li>Good: <strong>100 毫秒以下</strong> 👍</li>\n</ul>\n<div class=\"info\">\n<p>💡 <strong>補充：</strong><br />\n這個測量必須由用戶與網站的互動，因此這項測試的數據只會反應在使用者數據上，即不會出現在實驗室數據中(Lab Data)。</p>\n</div>\n<h3>優化方向</h3>\n<p>瀏覽器的主要執行緒(Main Thread)忙於執行的 JavaScript 時，會無法立即回應使用者想要的互動，所以可以朝減少 JavaScript 執行方向優化：</p>\n<ol>\n<li><strong>拆分長時間的工作，最小化主執行緒的工作</strong>\n<blockquote>\n<p>拆分出能非同步處理，等瀏覽器有空時執行</p>\n</blockquote>\n</li>\n<li><strong>減少 JavaScript 執行時間</strong></li>\n<li><strong>減少第三方程式的影響</strong></li>\n</ol>\n<div class=\"info\">\n<p>💡 <strong>補充：</strong><br />\n可以透過 <a  href=\"https://github.com/webpack-contrib/webpack-bundle-analyzer\" target=\"_blank\" rel=\"noreferrer noopener\">Webpack Bundle Analyzer</a> 的視覺化介面，快速分析出打包後的結果，含打包哪些檔案、檔案大小等，決定是否要拆分模組、動態載入，或改用較輕量的套件。</p>\n</div>\n<div class=\"warning\">\n<p>ℹ️ <a  href=\"https://web.dev/articles/inp?hl=zh-tw\" target=\"_blank\" rel=\"noreferrer noopener\">Interaction to Next Paint (INP)</a> 將於 2024 年 3 月取代 Core Web Vitals 中的 <a  href=\"https://web.dev/articles/fid?hl=zh-tw\" target=\"_blank\" rel=\"noreferrer noopener\">First Input Delay(FID)</a>。</p>\n</div>\n<h2 id=\"INP - 下次繪製互動時間 (Interaction to Next Paint)\" title=\"INP - 下次繪製互動時間 (Interaction to Next Paint)\"><a href=\"#INP - 下次繪製互動時間 (Interaction to Next Paint)\">INP - 下次繪製互動時間 (Interaction to Next Paint)</a></h2>\n<p><img src=\"https://hackmd.io/_uploads/Hy04i3n8a.png\" alt=\"image\" /></p>\n<p>觀察使用者在網頁造訪期間發生的點擊、輕觸和鍵盤互動所經歷的延遲時間，評估網頁回應使用者互動的整體效能（單位為毫秒）。</p>\n<ul>\n<li>評估互動</li>\n<li>Good: <strong>200 毫秒以下</strong> 👍</li>\n<li>偏低表示網頁能穩定回應使用者輸入的內容</li>\n</ul>\n<div class=\"info\">\n<p>💡 <strong>補充：</strong><br />\n滑鼠懸停 (hover) 和頁面捲動 (scrolling) 不會被納入 INP 的計算，但如果使用鍵盤捲動畫面，則可能會觸發 INP 的測量。</p>\n</div>\n<div class=\"info\">\n<p>💡 <strong>FID (首次輸入延遲時間) vs. INP (下次繪製互動時間)：</strong></p>\n<ol>\n<li>互動次數\n<ul>\n<li>FID 只會計入 <strong>「最初」</strong> 互動</li>\n<li>INP 會考量 <strong>「所有」</strong> 網頁互動</li>\n</ul>\n</li>\n<li>延遲時間\n<ul>\n<li>FID ：初次互動的<strong>輸入延遲</strong>時間</li>\n<li>INP ：<strong>輸入延遲</strong> + <strong>處理延遲</strong>(執行事件處理所需的時間) + <strong>顯示延遲</strong>(下一個影格繪製時間)</li>\n</ul>\n</li>\n</ol>\n<p>INP 會記錄使用者與網頁互動時發生的所有延遲，藉此全面評估回應速度，讓 INP 比 FID 更能準確反映整體回應速度。</p>\n</div>\n<h3>優化方向</h3>\n<p>針對互動三階段進行優化調整：</p>\n<p><img src=\"https://hackmd.io/_uploads/ryHOzTnU6.png\" alt=\"image\" /></p>\n<ol>\n<li>輸入延遲時間 (Input Delay)\n<blockquote>\n<p>同 FID 方向</p>\n</blockquote>\n</li>\n<li>處理時間，計算完成事件回呼所需的時間 (Processing Time)\n<blockquote>\n<p>優化 event callback，細拆分處理邏輯，如善用 <code>setTimeout</code></p>\n</blockquote>\n</li>\n<li>顯示延遲，是指瀏覽器顯示下一個頁框，包含互動結果 (Presentation Delay)\n<blockquote>\n<p>最小化 DOM 大小、限制 CSS 選取器複雜度、使用 <a  href=\"https://web.dev/articles/content-visibility?hl=zh-tw\" target=\"_blank\" rel=\"noreferrer noopener\"><code>content-visibility</code></a> 屬性</p>\n</blockquote>\n</li>\n</ol>\n<h2 id=\"測試工具\" title=\"測試工具\"><a href=\"#測試工具\">測試工具</a></h2>\n<h3>實驗室資料 (Lab Data)</h3>\n<p>在受控的環境(裝置及網路)中收集到的效能資料</p>\n<h4>優點</h4>\n<ol>\n<li>便於除錯和測試</li>\n<li>快速重現</li>\n</ol>\n<h4>限制</h4>\n<ol>\n<li>無法反映真實用戶的環境(使用者的裝置功能及網路狀況)</li>\n<li>無法關聯真實世界的頁面關鍵績效指標</li>\n</ol>\n<h4>代表工具</h4>\n<ul>\n<li><a  href=\"https://chromewebstore.google.com/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk?hl=zh-TW&amp;pli=1\" target=\"_blank\" rel=\"noreferrer noopener\">Lighthouse</a>\n<blockquote>\n<p>以電腦上的資源評量網站的效能指標，透過本機瀏覽器去測試網站</p>\n</blockquote>\n</li>\n<li><a  href=\"https://www.webpagetest.org/\" target=\"_blank\" rel=\"noreferrer noopener\">WebPageTest</a></li>\n</ul>\n<h3>場域資料/使用者資料 (Field Data)</h3>\n<p>由真實用戶收集到的效能資料，又稱 Real User Monitioring (RUM)</p>\n<h4>優點</h4>\n<ol>\n<li>反映真實世界的使用者體驗</li>\n<li>關聯到頁面關鍵績效指標</li>\n</ol>\n<h4>限制</h4>\n<ol>\n<li>有限的除錯能力</li>\n<li>有限的指標收集範圍</li>\n</ol>\n<h4>代表工具</h4>\n<ul>\n<li><a  href=\"https://developer.chrome.com/docs/crux/dashboard\" target=\"_blank\" rel=\"noreferrer noopener\">Chrome User Experience Report</a></li>\n<li><a  href=\"https://pagespeed.web.dev/\" target=\"_blank\" rel=\"noreferrer noopener\">PageSpeed Insights</a>\n<blockquote>\n<p>透過線上工具取得目標網站的效能指標，拿 Google 的 server 去測試目標網站</p>\n</blockquote>\n</li>\n</ul>\n<div class=\"info\">\n<p>💡 通常行動裝置分數會較電腦裝置較低</p>\n</div>\n<h3>工具清單</h3>\n<h4>線上</h4>\n<ul>\n<li><a  href=\"https://pagespeed.web.dev/\" target=\"_blank\" rel=\"noreferrer noopener\">PageSpeed Insights</a></li>\n<li><a  href=\"https://www.webpagetest.org/\" target=\"_blank\" rel=\"noreferrer noopener\">WebPageTest</a></li>\n</ul>\n<h4>Browser Extension</h4>\n<ul>\n<li><a  href=\"https://chrome.google.com/webstore/detail/web-vitals/ahfhijdlegdabablpippeagghigmibma/related\" target=\"_blank\" rel=\"noreferrer noopener\">Web Vitals</a></li>\n<li><a  href=\"https://chrome.google.com/webstore/detail/core-web-vitals/adeniimnihmbpgpbljmnohjpoolmgabj\" target=\"_blank\" rel=\"noreferrer noopener\">Core Web Vitals</a></li>\n<li><a  href=\"https://chrome.google.com/webstore/detail/cls-visualizer/jbbeihojggidiclbcneckhcblilapahn\" target=\"_blank\" rel=\"noreferrer noopener\">CLS Visualizer</a></li>\n<li><a  href=\"https://chrome.google.com/webstore/detail/core-web-vitals-visualize/mcffmgagphgpgkdclllnilokablhjcge\" target=\"_blank\" rel=\"noreferrer noopener\">Core Web Vitals Visualizer</a></li>\n</ul>\n<h4>Browser 內建</h4>\n<ul>\n<li>Lighthouse (Chromium-based)</li>\n<li>Performance insights (限定 Chrome)\n<blockquote>\n<p>建議 undock 開發者工具 + network disabled cache + 無痕</p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"結論\" title=\"結論\"><a href=\"#結論\">結論</a></h2>\n<p>想要優化指標分數，靠的不只是前端，因為行銷(追蹤數據)、廣告(盈利收入)、設計(畫面/組件設計)和後端(response time)等，也會直接或間接影響到分數表現。</p>\n<p>最後，不論指標、Lighthouse 分數、Performance insights 結果是高或低，最重要需關注的是<strong>使用者體驗</strong>，不需要過度追求高分數，但追求綠色標準還是有必要的。</p>\n<h2 id=\"參考資料\" title=\"參考資料\"><a href=\"#參考資料\">參考資料</a></h2>\n<ul>\n<li><a  href=\"https://web.dev/articles/vitals\" target=\"_blank\" rel=\"noreferrer noopener\">Web Vitals</a></li>\n<li><a  href=\"https://www.youtube.com/watch?v=evrNn54UkHQ\" target=\"_blank\" rel=\"noreferrer noopener\">Core Web Vitals: An everyday explanation</a></li>\n<li><a  href=\"https://web.dev/\" target=\"_blank\" rel=\"noreferrer noopener\">web.dev</a></li>\n<li><a  href=\"https://www.shubo.io/optimize-loading-speed/#%E5%84%AA%E5%8C%96%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%96%84%E7%94%A8%E7%B6%B2%E9%A0%81%E6%B8%AC%E9%80%9F%E5%B7%A5%E5%85%B7\" target=\"_blank\" rel=\"noreferrer noopener\">[教學] 網頁載入速度效能優化 (加速 30% 真實案例分享)</a></li>\n<li><a  href=\"https://www.iamtk.co/web-performance-roadmap\" target=\"_blank\" rel=\"noreferrer noopener\">TK —— Web Performance Roadmap</a></li>\n<li>保哥的前端效能調校實戰課程</li>\n</ul>\n","toc":{"title":"認識 Core Web Vitals","subtitles":["什麼是 Web Vitals","什麼是 Core Web Vitals","LCP - 最大內容繪製 (Largest Contentful Paint)","CLS - 累積佈局偏移 (Cumulative Layout Shift)","FID - 首次輸入延遲時間（First Input Delay）","INP - 下次繪製互動時間 (Interaction to Next Paint)","測試工具","結論","參考資料"]},"wordCount":1227}