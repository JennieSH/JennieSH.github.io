window.__NUXT__=(function(a,b,c){return {staticAssetsBase:"\u002F_nuxt\u002Fstatic\u002F1765978925",layout:"default",error:a,serverRendered:true,routePath:"\u002Fdev\u002FSecurity\u002Fwebconf-huli-note",config:{_app:{basePath:"\u002F",assetsPath:"\u002F_nuxt\u002F",cdnURL:a}},globalRefs:{},ssrRefs:{"articleMatter-Security-webconf-huli-note":{info:{title:b,fileName:"webconf-huli-note",description:"Huli 大大在 2025 WebConf 演講主題的重點整理筆記",createdAt:c,updatedAt:c,tags:["webconf","security"]},content:"\u003Ch6\u003Etags: \u003Ccode\u003Esecurity\u003C\u002Fcode\u003E\u003C\u002Fh6\u003E\n\u003Ch1 id=\"[WebConf 筆記] Huli - 從冷知識到漏洞：你不懂的 Web，駭客懂\" title=\"[WebConf 筆記] Huli - 從冷知識到漏洞：你不懂的 Web，駭客懂\"\u003E[WebConf 筆記] Huli - 從冷知識到漏洞：你不懂的 Web，駭客懂\u003C\u002Fh1\u003E\n\u003Cp\u003E這篇是 2025 Webconf 的筆記整理～\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ca  href=\"https:\u002F\u002Fwebconf.tw\u002Fagenda\u002F17\" target=\"_blank\" rel=\"noreferrer noopener\"\u003EHuli - 從冷知識到漏洞：你不懂的 Web\u003C\u002Fa\u003E ｜ \u003Ca  href=\"https:\u002F\u002Fspeakerdeck.com\u002Faszx87410\u002Fcong-leng-zhi-shi-dao-lou-dong-ni-bu-dong-de-web-hai-ke-dong-huli-at-webconf-taiwan-2025\" target=\"_blank\" rel=\"noreferrer noopener\"\u003E簡報\u003C\u002Fa\u003E ｜\u003Ca  href=\"https:\u002F\u002Fhackmd.io\u002F@webconf\u002FHJiwwqnxZe\u002F%2FkqRzuYEES9-RuzuW0FLsBg\" target=\"_blank\" rel=\"noreferrer noopener\"\u003E共筆\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E漏洞分三種\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E已知 bug，但時間來不及\u003C\u002Fli\u003E\n\u003Cli\u003E好像有碰過，但忘記了\u003C\u002Fli\u003E\n\u003Cli\u003E不知道這樣寫有問題\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003E這次例子會聚焦討論第三種～\u003C\u002Fp\u003E\n\u003Ch2 id=\"Case 1. user.email 一定會與 email 相等嗎？\" title=\"Case 1. user.email 一定會與 email 相等嗎？\"\u003E\u003Ca href=\"#Case 1. user.email 一定會與 email 相等嗎？\"\u003ECase 1. user.email 一定會與 email 相等嗎？\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EforgotPassword\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Ereq, res\u003C\u002Fspan\u003E) {\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E email = req.\u003Cspan class=\"hljs-property\"\u003Ebody\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-property\"\u003Eemail\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-title function_\"\u003EtoLowerCase\u003C\u002Fspan\u003E();\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E user = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EsafeSQL\u003C\u002Fspan\u003E(\n    \u003Cspan class=\"hljs-string\"\u003E&quot;select * from users where email = ?&quot;\u003C\u002Fspan\u003E,\n    [email] \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 用 email 找出 user\u003C\u002Fspan\u003E\n  );\n\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (user) {\n    userService\n      .\u003Cspan class=\"hljs-title function_\"\u003EsendResetLink\u003C\u002Fspan\u003E({\n        \u003Cspan class=\"hljs-attr\"\u003Elink\u003C\u002Fspan\u003E: userService.\u003Cspan class=\"hljs-title function_\"\u003EgenerateLink\u003C\u002Fspan\u003E(user.\u003Cspan class=\"hljs-property\"\u003Eid\u003C\u002Fspan\u003E),\n        \u003Cspan class=\"hljs-attr\"\u003Eto\u003C\u002Fspan\u003E: email \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 寄重置密碼信給 user\u003C\u002Fspan\u003E\n      })\n      .\u003Cspan class=\"hljs-title function_\"\u003Ecatch\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-variable language_\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-property\"\u003Eerror\u003C\u002Fspan\u003E);\n  }\n\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E res.\u003Cspan class=\"hljs-title function_\"\u003Estatus\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-number\"\u003E204\u003C\u002Fspan\u003E).\u003Cspan class=\"hljs-title function_\"\u003Eend\u003C\u002Fspan\u003E();\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FByKbaQeXWl.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cbr \u002F\u003E\nMySQL 不是直接用「字元的實際編碼值」來比較字串，而是先把字元轉換成 \u003Cstrong\u003E權重（weight）\u003C\u002Fstrong\u003E，再用權重比較。\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E不同的 DB 背後比較方式不同，不是每個 DB 都會這樣。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FS14Haml7Wl.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Ch3\u003E如何攻擊？\u003C\u002Fh3\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FHy6Upmg7Zx.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E解法：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EforgotPassword\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Ereq, res\u003C\u002Fspan\u003E) {\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E email = req.\u003Cspan class=\"hljs-property\"\u003Ebody\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-property\"\u003Eemail\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-title function_\"\u003EtoLowerCase\u003C\u002Fspan\u003E();\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E user = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EsafeSQL\u003C\u002Fspan\u003E(\n    \u003Cspan class=\"hljs-string\"\u003E&quot;select * from users where email = ?&quot;\u003C\u002Fspan\u003E,\n    [email] \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 用 email 找出 user\u003C\u002Fspan\u003E\n  );\n\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (user) {\n    userService\n      .\u003Cspan class=\"hljs-title function_\"\u003EsendResetLink\u003C\u002Fspan\u003E({\n        \u003Cspan class=\"hljs-attr\"\u003Elink\u003C\u002Fspan\u003E: userService.\u003Cspan class=\"hljs-title function_\"\u003EgenerateLink\u003C\u002Fspan\u003E(user.\u003Cspan class=\"hljs-property\"\u003Eid\u003C\u002Fspan\u003E),\n        \u003Cspan class=\"hljs-attr\"\u003Eto\u003C\u002Fspan\u003E: email \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F fix: fix: user.email\u003C\u002Fspan\u003E\n      })\n      .\u003Cspan class=\"hljs-title function_\"\u003Ecatch\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-variable language_\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-property\"\u003Eerror\u003C\u002Fspan\u003E);\n  }\n\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E res.\u003Cspan class=\"hljs-title function_\"\u003Estatus\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-number\"\u003E204\u003C\u002Fspan\u003E).\u003Cspan class=\"hljs-title function_\"\u003Eend\u003C\u002Fspan\u003E();\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3\u003E結論：不同 context 的相等就是不相等\u003C\u002Fh3\u003E\n\u003Ch2 id=\"Case 2. 在 AI 取代人之前，先小心你的字串被取代\" title=\"Case 2. 在 AI 取代人之前，先小心你的字串被取代\"\u003E\u003Ca href=\"#Case 2. 在 AI 取代人之前，先小心你的字串被取代\"\u003ECase 2. 在 AI 取代人之前，先小心你的字串被取代\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E tmpl = \u003Cspan class=\"hljs-string\"\u003E&#x27;&lt;button value=&quot;{{value}}&quot;&gt;click&lt;\u002Fbutton&gt;&#x27;\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E value = \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EURL\u003C\u002Fspan\u003E(location.\u003Cspan class=\"hljs-property\"\u003Ehref\u003C\u002Fspan\u003E).\u003Cspan class=\"hljs-property\"\u003EsearchParams\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-title function_\"\u003Eget\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;v&quot;\u003C\u002Fspan\u003E);\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E safeValue = value.\u003Cspan class=\"hljs-title function_\"\u003Ereplace\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-regexp\"\u003E\u002F[&lt;&gt;&quot;]\u002Fg\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-string\"\u003E&quot;&quot;\u003C\u002Fspan\u003E); \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 移除特殊字元\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-variable language_\"\u003Edocument\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-property\"\u003Ebody\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-property\"\u003EinnerHTML\u003C\u002Fspan\u003E = tmpl.\u003Cspan class=\"hljs-title function_\"\u003Ereplace\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;{{value}}&quot;\u003C\u002Fspan\u003E, value); \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 取代\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cstrong\u003EBut\u003C\u002Fstrong\u003E ! 這是 JavaScript，當使用在正則表示式（RegExp）中，用「字串」作為取代時，可以使用的特殊替換符號\u003Ccode\u003E$\u003C\u002Fcode\u003E：\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FHJhYT7em-x.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Ch3\u003E如何攻擊？\u003C\u002Fh3\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FHyt2TQxQbg.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E這是前端典型前端 XSS 攻擊，可以透過 \u003Ccode\u003E&lt;button&gt;\u003C\u002Fcode\u003E + \u003Ccode\u003EonClick\u003C\u002Fcode\u003E，塞入想要攻擊的程式碼。\u003C\u002Fp\u003E\n\u003Ch3\u003E結論：字串取代要小心\u003C\u002Fh3\u003E\n\u003Ch2 id=\"Case 3. Clean 不是真的 Clean，Join 不是真的 Join\" title=\"Case 3. Clean 不是真的 Clean，Join 不是真的 Join\"\u003E\u003Ca href=\"#Case 3. Clean 不是真的 Clean，Join 不是真的 Join\"\u003ECase 3. Clean 不是真的 Clean，Join 不是真的 Join\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Ch3\u003EGo 的 Clean\u003C\u002Fh3\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E {\n    filename := \u003Cspan class=\"hljs-string\"\u003E&quot;test.js&quot;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user-controlled\u003C\u002Fspan\u003E\n    pluginFilePath := filepath.Join(\u003Cspan class=\"hljs-string\"\u003E&quot;\u002Fetc\u002Fplugins&quot;\u003C\u002Fspan\u003E, filename)\n    fmt.Printf(\u003Cspan class=\"hljs-string\"\u003E&quot;Output: %q\u002Fn&quot;\u003C\u002Fspan\u003E, pluginFilePath) \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F \u002Fetc\u002Fplugins\u002Ftest.js\u003C\u002Fspan\u003E\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 會往外面資料夾查找\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E {\n    filename := \u003Cspan class=\"hljs-string\"\u003E&quot;..\u002F..\u002Fetc\u002Fhosts&quot;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user-controlled\u003C\u002Fspan\u003E\n    pluginFilePath := filepath.Join(\u003Cspan class=\"hljs-string\"\u003E&quot;\u002Fetc\u002Fplugins&quot;\u003C\u002Fspan\u003E, filename)\n    fmt.Printf(\u003Cspan class=\"hljs-string\"\u003E&quot;Output: %q\u002Fn&quot;\u003C\u002Fspan\u003E, pluginFilePath) \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F \u002Fetc\u002Fplugins\u002F..\u002F..\u002Fetc\u002Fhosts\u003C\u002Fspan\u003E\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E {\n    filename := filepath.Clean(\u003Cspan class=\"hljs-string\"\u003E&quot;..\u002F..\u002Fetc\u002Fhosts&quot;\u003C\u002Fspan\u003E)\n    pluginFilePath := filepath.Join(\u003Cspan class=\"hljs-string\"\u003E&quot;\u002Fetc\u002Fplugins&quot;\u003C\u002Fspan\u003E, filename)\n    fmt.Printf(\u003Cspan class=\"hljs-string\"\u003E&quot;Output: %q\u002Fn&quot;\u003C\u002Fspan\u003E, pluginFilePath) \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F &quot;\u002Fetc\u002Fhosts&quot;\u003C\u002Fspan\u003E\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch4\u003E重點：加了 Clean 也一樣會被穿越\u003C\u002Fh4\u003E\n\u003Cp\u003E以為「先 Clean 就安全」，但不對：\u003C\u002Fp\u003E\n\u003Cp\u003EClean 只是在整理字串，沒有限制結果一定留在 \u002Fetc\u002Fplugins 底下。\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003EGo - \u003Ca  href=\"https:\u002F\u002Fpkg.go.dev\u002Fpath\u002Ffilepath#Clean\" target=\"_blank\" rel=\"noreferrer noopener\"\u003EClean Doc\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003EReplace multiple \u003Ca  href=\"https:\u002F\u002Fpkg.go.dev\u002Fpath\u002Ffilepath#Separator\" target=\"_blank\" rel=\"noreferrer noopener\"\u003ESeparator\u003C\u002Fa\u003E elements with a single one.\u003C\u002Fli\u003E\n\u003Cli\u003EEliminate each . path name element (the current directory).\u003C\u002Fli\u003E\n\u003Cli\u003EEliminate each \u003Cstrong\u003Einner … path\u003C\u002Fstrong\u003E name element (the parent directory) along with the non-… element that precedes it.\u003C\u002Fli\u003E\n\u003Cli\u003EEliminate … elements that \u003Cstrong\u003Ebegin a rooted path\u003C\u002Fstrong\u003E: that is, replace “\u002F…” by “\u002F” at the beginning of a path, assuming Separator is ‘\u002F’.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003E⇒ filepath.Join 不會限制你一定要留在 \u002Fetc\u002Fplugins 裡，它只負責算出「合理的路徑」。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E如果後面拿 pluginFilePath 去 os.Open \u002F ReadFile，就\u003Cstrong\u003E不是 plugins，而是系統檔案\u003C\u002Fstrong\u003E，這就是典型目錄穿越 (path traversal) 風險。\u003C\u002Fp\u003E\n\u003Ch4\u003E攻擊例子：\u003Ca  href=\"https:\u002F\u002Fgithub.com\u002Fgrafana\u002Fgrafana\u002Fsecurity\u002Fadvisories\u002FGHSA-8pjx-jj86-j47p\" target=\"_blank\" rel=\"noreferrer noopener\"\u003EGrafana path traversal\u003C\u002Fa\u003E\u003C\u002Fh4\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FSklxA7emZg.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E有其他的 Go 開發者想發 PR 解決這問題，但目前 PR 進度從 2020 年還停留在 In Progress :\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FHJbWAQlQbl.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Ch3\u003EPython 的 Join\u003C\u002Fh3\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E os\n\nfilename = \u003Cspan class=\"hljs-string\"\u003E&#x27;..\u002F..\u002Fetc\u002Fhosts&#x27;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&#x27;..&#x27;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E filename:\n    \u003Cspan class=\"hljs-keyword\"\u003Eraise\u003C\u002Fspan\u003E ValueError(\u003Cspan class=\"hljs-string\"\u003E&#x27;invalid filename&#x27;\u003C\u002Fspan\u003E)\n\nresult = os.path.join(\u003Cspan class=\"hljs-string\"\u003E&#x27;\u002Ftmp\u002Ftest&#x27;\u003C\u002Fspan\u003E, filename)\n\u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E(result)  \u003Cspan class=\"hljs-comment\"\u003E# ValueError: invalid filename\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E這個例子在 \u003Ccode\u003E..\u002F\u003C\u002Fcode\u003E 開頭檔案名沒問題，會直接報錯誤，接下來再看看傳入 \u003Ccode\u003E\u002Fetc\u002Fhosts\u003C\u002Fcode\u003E，居然不是預期出現的 \u003Ccode\u003E\u002Ftmp\u002Ftest\u002Fetc\u002Fhosts\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E os\n\nfilename = \u003Cspan class=\"hljs-string\"\u003E&#x27;\u002Fetc\u002Fhosts&#x27;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&#x27;..&#x27;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E filename:\n    \u003Cspan class=\"hljs-keyword\"\u003Eraise\u003C\u002Fspan\u003E ValueError(\u003Cspan class=\"hljs-string\"\u003E&#x27;invalid filename&#x27;\u003C\u002Fspan\u003E)\n\nresult = os.path.join(\u003Cspan class=\"hljs-string\"\u003E&#x27;\u002Ftmp\u002Ftest&#x27;\u003C\u002Fspan\u003E, filename)\n\u003Cspan class=\"hljs-built_in\"\u003Eprint\u003C\u002Fspan\u003E(result)  \u003Cspan class=\"hljs-comment\"\u003E# \u002Fetc\u002Fhosts\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E因為在 Python 裡，\u003Ccode\u003Eos.path.join(base, path)\u003C\u002Fcode\u003E 的規則，如果後面的參數是 \u003Cstrong\u003E絕對路徑\u003C\u002Fstrong\u003E（以 \u003Ccode\u003E\u002F\u003C\u002Fcode\u003E 開頭），前面的路徑會被 \u003Cstrong\u003E直接忽略\u003C\u002Fstrong\u003E：\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ca  href=\"https:\u002F\u002Farc.net\u002Fl\u002Fquote\u002Fttslaxed\" target=\"_blank\" rel=\"noreferrer noopener\"\u003Eos.path.\u003Cstrong\u003Ejoin\u003C\u002Fstrong\u003E(\u003Cem\u003Epath\u003C\u002Fem\u003E, \u003Cem\u003E\u002F\u003C\u002Fem\u003E, \u003Cem\u003E*paths\u003C\u002Fem\u003E)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EJoin one or more path segments intelligently. The return value is the concatenation of \u003Cem\u003Epath\u003C\u002Fem\u003E and all members of \u003Cem\u003E*paths\u003C\u002Fem\u003E, with exactly one directory separator following each non-empty part, except the last. That is, the result will only end in a separator if the last part is either empty or ends in a separator. \u003Cstrong\u003EIf a segment is an absolute path (which on Windows requires both a drive and a root), then all previous segments are ignored and joining continues from the absolute path segment.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch3\u003E結論：要看官方文件和寫好測試，確保 output 是對的\u003C\u002Fh3\u003E\n\u003Ch2 id=\"Case 4. React is\" title=\"Case 4. React is\"\u003E\u003Ca href=\"#Case 4. React is\"\u003ECase 4. React is\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EApp\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E\u003C\u002Fspan\u003E) {\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 把網址 query string（?a=1&amp;b=2）轉成物件\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E params = \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title class_\"\u003EURLSearchParams\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-variable language_\"\u003Ewindow\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-property\"\u003Elocation\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-property\"\u003Esearch\u003C\u002Fspan\u003E);\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E obj = \u003Cspan class=\"hljs-title class_\"\u003EObject\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-title function_\"\u003EfromEntries\u003C\u002Fspan\u003E(params);\n\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"language-xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ediv\u003C\u002Fspan\u003E {\u003Cspan class=\"hljs-attr\"\u003E...obj\u003C\u002Fspan\u003E}&gt;\u003C\u002Fspan\u003EHello\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3\u003E如何攻擊？\u003C\u002Fh3\u003E\n\u003Ch4\u003EdangerouslySetInnerHTML ?\u003C\u002Fh4\u003E\n\u003Cp\u003E不會有危險，因為要執行 dangerouslySetInnerHTML 的條件：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003Eprop 名字 \u003Cstrong\u003E必須是 \u003Ccode\u003EdangerouslySetInnerHTML\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E\u003C\u002Fli\u003E\n\u003Cli\u003Evalue \u003Cstrong\u003E必須是物件\u003C\u002Fstrong\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E物件 key \u003Cstrong\u003E必須是 \u003Ccode\u003E__html\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E&lt;div dangerouslySetInnerHTML={{ \u003Cspan class=\"hljs-attr\"\u003E__html\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;&lt;img onerror=alert(1)&gt;&quot;\u003C\u002Fspan\u003E }} \u002F&gt;\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E例子中 URLSearchParams 的特性是：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E所有值都是字串\u003C\u002Fli\u003E\n\u003Cli\u003E沒有巢狀結構\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003E即使使用者傳入：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E?dangerouslySetInnerHTML=\u003Cspan class=\"language-xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eimg\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eonerror\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003Ealert(1)\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E最後變成：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E{\n  \u003Cspan class=\"hljs-attr\"\u003EdangerouslySetInnerHTML\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;&lt;img src=x onerror=alert(1)&gt;&quot;\u003C\u002Fspan\u003E\n}\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F React 看到的\u003C\u002Fspan\u003E\n&lt;div dangerouslySetInnerHTML=\u003Cspan class=\"hljs-string\"\u003E&quot;...&quot;\u003C\u002Fspan\u003E&gt;\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EReact 會把它當成「一個普通、未知的 attribute」，\u003Cstrong\u003E不會執行\u003C\u002Fstrong\u003E。\u003C\u002Fp\u003E\n\u003Ch4\u003Eonclick \u002F onClick ?\u003C\u002Fh4\u003E\n\u003Cp\u003E\u003Cstrong\u003E\u003Ccode\u003Eonclick\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E：HTML attribute（小寫）在 React 也不會變成可執行事件，只當作一般 attribute。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FB1wN07xXbl.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003E\u003Ccode\u003EonClick\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E：React 事件，\u003Cstrong\u003E必須是 function\u003C\u002Fstrong\u003E，不能是字串。\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 只會是字串\u003C\u002Fspan\u003E\nobj = { \u003Cspan class=\"hljs-attr\"\u003EonClick\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;alert(1)&quot;\u003C\u002Fspan\u003E };\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F React 看到的\u003C\u002Fspan\u003E\n\u003Cspan class=\"language-xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003EonClick\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E&quot;alert(1)&quot;\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EHello\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FH1LrRQeXZg.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Ch4\u003Eweb-component ?\u003C\u002Fh4\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EApp\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E\u003C\u002Fspan\u003E) {\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E obj = {\n    \u003Cspan class=\"hljs-attr\"\u003Eis\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;huli&quot;\u003C\u002Fspan\u003E,\n    \u003Cspan class=\"hljs-attr\"\u003Eonclick\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;alert(1)&quot;\u003C\u002Fspan\u003E\n  };\n\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"language-xml\"\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ediv\u003C\u002Fspan\u003E {\u003Cspan class=\"hljs-attr\"\u003E...obj\u003C\u002Fspan\u003E}&gt;\u003C\u002Fspan\u003EHello\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E;\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E這是 React 為了支援 custom component 而做的邏輯\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FB19dA7xmZx.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E只要加入 is ，就會忽略 L105 的 o\u002FO\u002Fn\u002FN 的檢查：\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FrkU5R7lX-x.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E不過在 React 19 版本後改掉了～\u003C\u002Fp\u003E\n\u003Ch3\u003E結論：絕對不要把使用者的輸入照單全收\u003C\u002Fh3\u003E\n\u003Ch2 id=\"Case 5. 小心使用 regex\" title=\"Case 5. 小心使用 regex\"\u003E\u003Ca href=\"#Case 5. 小心使用 regex\"\u003ECase 5. 小心使用 regex\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 嘗試判斷字串中是否「看起來像 HTML tag」，用來避免 XSS\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EisUnsafeString\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Estr\u003C\u002Fspan\u003E) {\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 只要字串中「同時出現 &lt;，而且後面某處出現 &gt; 或 =」，就當成不安全\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E regex = \u003Cspan class=\"hljs-regexp\"\u003E\u002F.*[&lt;].*[&gt;=].*\u002F\u003C\u002Fspan\u003Es;\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E regex.\u003Cspan class=\"hljs-title function_\"\u003Etest\u003C\u002Fspan\u003E(str);\n}\n\n\u003Cspan class=\"hljs-title function_\"\u003EisUnsafeString\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;&lt;svg&gt;&quot;\u003C\u002Fspan\u003E); \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F true\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-title function_\"\u003EisUnsafeString\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;&lt;svg onload=alert()&quot;\u003C\u002Fspan\u003E); \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F true\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-title function_\"\u003EisUnsafeString\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;&lt;svg onload=alert()&gt;&quot;\u003C\u002Fspan\u003E); \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F true\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-title function_\"\u003EisUnsafeString\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;hello &lt;3&quot;\u003C\u002Fspan\u003E); \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F false\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3\u003E如何攻擊 ？\u003C\u002Fh3\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EisUnsafeString\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Estr\u003C\u002Fspan\u003E) {\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E regex = \u003Cspan class=\"hljs-regexp\"\u003E\u002F.*[&lt;].*[&gt;=].*\u002F\u003C\u002Fspan\u003Es;\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E regex.\u003Cspan class=\"hljs-title function_\"\u003Etest\u003C\u002Fspan\u003E(str);\n}\n\n\u003Cspan class=\"hljs-variable language_\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-title function_\"\u003Etime\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;test&quot;\u003C\u002Fspan\u003E);\n\u003Cspan class=\"hljs-title function_\"\u003EisUnsafeString\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;&lt;svg&gt;&quot;\u003C\u002Fspan\u003E + \u003Cspan class=\"hljs-string\"\u003E&quot;&lt;&quot;\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-title function_\"\u003Erepeat\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-number\"\u003E50000\u003C\u002Fspan\u003E));\n\u003Cspan class=\"hljs-variable language_\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-title function_\"\u003EtimeEnd\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&quot;test&quot;\u003C\u002Fspan\u003E);\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F test: 1.218s\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E透過設計過的字串，讓正則跑得非常慢，直接卡死主執行緒，這就是 ReDoS(Regular Expression Denial of Service)。\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E可參考簡報例子的\u003Ca  href=\"https:\u002F\u002Fspeakerdeck.com\u002Faszx87410\u002Fcong-leng-zhi-shi-dao-lou-dong-ni-bu-dong-de-web-hai-ke-dong-huli-at-webconf-taiwan-2025?slide=68\" target=\"_blank\" rel=\"noreferrer noopener\"\u003E配對講解\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E[補充] 更深入的 ReDoS 文章 - \u003Ca  href=\"https:\u002F\u002Fblog.huli.tw\u002F2023\u002F06\u002F12\u002Fredos-regular-expression-denial-of-service\u002F\" target=\"_blank\" rel=\"noreferrer noopener\"\u003E正規表達式沒寫好會怎樣？淺談 ReDoS：利用 regexp 的攻擊\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E不過\u003Cstrong\u003E不同的程式語言的配對引擎不同\u003C\u002Fstrong\u003E，效能表現可能差很多：\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cstrong\u003EElixir：\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Edefmodule TimeTest do\n  def is_unsafe_string(str) do\n    Regex.match?(~r\u002F.*[&lt;].*[&gt;=].*\u002Fis, str)\n  end\n\n  def run_test do\n    str = &quot;&lt;svg&gt;&quot; &lt;&gt; String.duplicate(&quot;&lt;&quot;, 50_000)\n\n    {time_microseconds, _result} =\n      :timer.tc(fn -&gt; is_unsafe_string(str) end)\n\n    IO.puts(&quot;test: #{time_microseconds \u002F 1_000_000}s&quot;)\n    # 0.098338s\n  end\nend\n\nTimeTest.run_test()\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cstrong\u003EPHP\u003C\u002Fstrong\u003E：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-meta\"\u003E&lt;?php\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EisUnsafeString\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E\u003Cspan class=\"hljs-variable\"\u003E$str\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-variable\"\u003E$regex\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-string\"\u003E&#x27;\u002F.*[&lt;].*[&gt;=].*\u002Fs&#x27;\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E preg_match(\u003Cspan class=\"hljs-variable\"\u003E$regex\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-variable\"\u003E$str\u003C\u002Fspan\u003E);\n}\n\n\u003Cspan class=\"hljs-variable\"\u003E$start\u003C\u002Fspan\u003E = microtime(\u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E);\nisUnsafeString(\u003Cspan class=\"hljs-string\"\u003E&#x27;&lt;svg&gt;&#x27;\u003C\u002Fspan\u003E . str_repeat(\u003Cspan class=\"hljs-string\"\u003E&#x27;&lt;&#x27;\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-number\"\u003E50000\u003C\u002Fspan\u003E));\n\u003Cspan class=\"hljs-variable\"\u003E$end\u003C\u002Fspan\u003E = microtime(\u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E);\n\n\u003Cspan class=\"hljs-variable\"\u003E$time\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-variable\"\u003E$end\u003C\u002Fspan\u003E - \u003Cspan class=\"hljs-variable\"\u003E$start\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eecho\u003C\u002Fspan\u003E number_format(\u003Cspan class=\"hljs-variable\"\u003E$time\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-number\"\u003E3\u003C\u002Fspan\u003E) . \u003Cspan class=\"hljs-string\"\u003E&quot;s\\n&quot;\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 0.001s\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-meta\"\u003E?&gt;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cstrong\u003E不過這樣就沒問題了嗎？\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EElixir 實際上它沒有執行完，是設計了一個 backtracking 的上限，到達上限時就不繼續配對。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FryenR7emWg.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EPHP 如果正則在運算過程中碰到限制或錯誤（如 backtrack 次數上限），\u003Ccode\u003Epreg_match()\u003C\u002Fcode\u003E 會回傳 \u003Cstrong\u003E\u003Ccode\u003Efalse\u003C\u002Fcode\u003E\u003C\u002Fstrong\u003E，表示「regex 執行失敗」，而不是「沒匹配」。\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ca  href=\"https:\u002F\u002Fwww.php.net\u002Fmanual\u002Fen\u002Ffunction.preg-match.php#refsect1-function.preg-match-returnvalues\" target=\"_blank\" rel=\"noreferrer noopener\"\u003Epreg_match() returns 1 if the pattern matches given subject, 0 if it does not, or false on failure.\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FB1_0Amembl.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E如果程式寫成下方這樣，\u003Cstrong\u003E攻擊者就可以用超長輸入把 regex 打到失敗，讓檢查「自動放行」\u003C\u002Fstrong\u003E，繞過程式的安全檢查。\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (!isUnsafeString(\u003Cspan class=\"hljs-variable\"\u003E$input\u003C\u002Fspan\u003E)) {\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 當成安全\u003C\u002Fspan\u003E\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3\u003E結論：使用線上 regex checker 或 AI 幫忙\u003C\u002Fh3\u003E\n\u003Ch2 id=\"總結\" title=\"總結\"\u003E\u003Ca href=\"#總結\"\u003E總結\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Col\u003E\n\u003Cli\u003EMySQL unicode =&gt; context 的不相等\u003C\u002Fli\u003E\n\u003Cli\u003EJS replace 時請小心謹慎\u003C\u002Fli\u003E\n\u003Cli\u003EClean 不是真的 clean，join 不是真的 join\u003C\u002Fli\u003E\n\u003Cli\u003EReact is =&gt; 不要全盤相信使用者輸入\u003C\u002Fli\u003E\n\u003Cli\u003E小心使用 regex\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n",toc:{title:b,subtitles:["Case 1. user.email 一定會與 email 相等嗎？","Case 2. 在 AI 取代人之前，先小心你的字串被取代","Case 3. Clean 不是真的 Clean，Join 不是真的 Join","Case 4. React is","Case 5. 小心使用 regex","總結"]},wordCount:1759}}}}(null,"[WebConf 筆記] Huli - 從冷知識到漏洞：你不懂的 Web，駭客懂","2025-12-14T00:00:00.000Z"));