window.__NUXT__=(function(a,b,c){return {staticAssetsBase:"\u002F_nuxt\u002Fstatic\u002F1765984196",layout:"default",error:a,serverRendered:true,routePath:"\u002Fdev\u002FDatabase\u002Fpgpass-dbeaver",config:{_app:{basePath:"\u002F",assetsPath:"\u002F_nuxt\u002F",cdnURL:a}},globalRefs:{},ssrRefs:{"articleMatter-Database-pgpass-dbeaver":{info:{title:b,fileName:"pgpass-dbeaver",description:"如何使用 Pgpass 連線 Dbeaver",createdAt:c,updatedAt:c,tags:["database","postgresql","dbeaver"]},content:"\u003Ch1 id=\"Pgpass 連線 Dbeaver feat. GCP\" title=\"Pgpass 連線 Dbeaver feat. GCP\"\u003EPgpass 連線 Dbeaver feat. GCP\u003C\u002Fh1\u003E\n\u003Ch2 id=\"安裝\" title=\"安裝\"\u003E\u003Ca href=\"#安裝\"\u003E安裝\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Ch3\u003E1. 安裝 dbeaver\u003C\u002Fh3\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Ebrew install --cask dbeaver-community\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3\u003E2. 安裝 GCP CLI\u003C\u002Fh3\u003E\n\u003Cp\u003E前往官方網站下載 SDK：\u003Ca  href=\"https:\u002F\u002Fcloud.google.com\u002Fsdk\u002Fdocs\u002Finstall?hl=zh-cn#installation_instructions\" target=\"_blank\" rel=\"noreferrer noopener\"\u003Ehttps:\u002F\u002Fcloud.google.com\u002Fsdk\u002Fdocs\u002Finstall\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E下載後執行安裝（請先 \u003Ccode\u003Ecd\u003C\u002Fcode\u003E 至檔案所在位置）：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E.\u002Fgoogle-cloud-sdk\u002Finstall.sh\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3\u003E3. 安裝 GCP Cloud SQL Proxy\u003C\u002Fh3\u003E\n\u003Cp\u003E下載至 Home 目錄並設權限：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Ecurl -o cloud-sql-proxy https:\u002F\u002Fstorage.googleapis.com\u002Fcloud-sql-connectors\u002Fcloud-sql-proxy\u002Fv2.15.2\u002Fcloud-sql-proxy.darwin.arm64\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-built_in\"\u003Echmod\u003C\u002Fspan\u003E +x cloud-sql-proxy\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E重新載入環境變數設定：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-built_in\"\u003Esource\u003C\u002Fspan\u003E ~\u002F.zshrc\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E登入 GCP 帳號：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Egcloud auth application-default login\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ctable\u003E\n\u003Cthead\u003E\n\u003Ctr\u003E\n\u003Cth\u003E你要做的事\u003C\u002Fth\u003E\n\u003Cth\u003E建議用哪個指令\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E想在 CLI 操作 GCP\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Ccode\u003Egcloud auth login\u003C\u002Fcode\u003E\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E在 Python、Node.js 寫 code 存取 GCP 資源\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Ccode\u003Egcloud auth application-default login\u003C\u002Fcode\u003E\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Ch2 id=\"Pgpass 設定\" title=\"Pgpass 設定\"\u003E\u003Ca href=\"#Pgpass 設定\"\u003EPgpass 設定\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Ch3\u003E1. 建立 \u003Ccode\u003E.pgpass\u003C\u002Fcode\u003E 檔案\u003C\u002Fh3\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Etouch ~\u002F.pgpass\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Evi ~\u002F.pgpass\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E檔案內容格式如下：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Elocalhost:{PORT}:{DB name}:{email}:__TOKEN__\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E說明：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003EPORT\u003C\u002Fcode\u003E 可自訂，但需與 DBeaver 設定一致\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003EDB name\u003C\u002Fcode\u003E 根據實際使用的環境命名\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Eemail\u003C\u002Fcode\u003E 請填入你自己的帳號（如 \u003Ccode\u003Exxx.xxx@test.com.tw\u003C\u002Fcode\u003E）\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E範例：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Elocalhost:5433:dev:{email}:__TOKEN__\nlocalhost:5434:uat:{email}:__TOKEN__\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3\u003E2. 設定 alias 與自動更新 token\u003C\u002Fh3\u003E\n\u003Cp\u003E建立 alias 設定檔：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Etouch ~\u002F.oh-my-zsh\u002Fcustom\u002Falias.zsh\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Evi ~\u002F.oh-my-zsh\u002Fcustom\u002Falias.zsh\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E加入以下內容：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-built_in\"\u003Eexport\u003C\u002Fspan\u003E GCLOUD_EMAIL=xxx.xxx@test.com.tw\n\n\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-title\"\u003Epg_update_iam\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E() {\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E [[ -z \u003Cspan class=\"hljs-string\"\u003E&quot;\u003Cspan class=\"hljs-variable\"\u003E$GCLOUD_EMAIL\u003C\u002Fspan\u003E&quot;\u003C\u002Fspan\u003E ]]; \u003Cspan class=\"hljs-keyword\"\u003Ethen\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-built_in\"\u003Eecho\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&quot;GCLOUD_EMAIL is not set. Please add &#x27;export GCLOUD_EMAIL=your_email&#x27; to alias.zsh&quot;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-built_in\"\u003Ereturn\u003C\u002Fspan\u003E 1\n  \u003Cspan class=\"hljs-keyword\"\u003Efi\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"hljs-built_in\"\u003Elocal\u003C\u002Fspan\u003E token=$(gcloud auth print-access-token --account=\u003Cspan class=\"hljs-string\"\u003E&quot;\u003Cspan class=\"hljs-variable\"\u003E$GCLOUD_EMAIL\u003C\u002Fspan\u003E&quot;\u003C\u002Fspan\u003E)\n\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E [[ -z \u003Cspan class=\"hljs-string\"\u003E&quot;\u003Cspan class=\"hljs-variable\"\u003E$token\u003C\u002Fspan\u003E&quot;\u003C\u002Fspan\u003E ]]; \u003Cspan class=\"hljs-keyword\"\u003Ethen\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-built_in\"\u003Eecho\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&quot;Failed to get token for \u003Cspan class=\"hljs-variable\"\u003E$GCLOUD_EMAIL\u003C\u002Fspan\u003E&quot;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-built_in\"\u003Ereturn\u003C\u002Fspan\u003E 1\n  \u003Cspan class=\"hljs-keyword\"\u003Efi\u003C\u002Fspan\u003E\n\n  sed -i \u003Cspan class=\"hljs-string\"\u003E&quot;&quot;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&quot;s|^localhost:5433:ktw_dev:\u003Cspan class=\"hljs-variable\"\u003E$GCLOUD_EMAIL\u003C\u002Fspan\u003E:.*$|localhost:5433:ktw_dev:\u003Cspan class=\"hljs-variable\"\u003E$GCLOUD_EMAIL\u003C\u002Fspan\u003E:\u003Cspan class=\"hljs-variable\"\u003E$token\u003C\u002Fspan\u003E|&quot;\u003C\u002Fspan\u003E ~\u002F.pgpass\n  sed -i \u003Cspan class=\"hljs-string\"\u003E&quot;&quot;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&quot;s|^localhost:5434:ktw_uat:\u003Cspan class=\"hljs-variable\"\u003E$GCLOUD_EMAIL\u003C\u002Fspan\u003E:.*$|localhost:5434:ktw_uat:\u003Cspan class=\"hljs-variable\"\u003E$GCLOUD_EMAIL\u003C\u002Fspan\u003E:\u003Cspan class=\"hljs-variable\"\u003E$token\u003C\u002Fspan\u003E|&quot;\u003C\u002Fspan\u003E ~\u002F.pgpass\n}\n\n\u003Cspan class=\"hljs-built_in\"\u003Ealias\u003C\u002Fspan\u003E pg_proxy_dev=\u003Cspan class=\"hljs-string\"\u003E&#x27;pg_update_iam &amp;&amp; ~\u002Fcloud-sql-proxy dev-everything:asia-east1:ktw-dev --port=5433&#x27;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-built_in\"\u003Ealias\u003C\u002Fspan\u003E pg_proxy_uat=\u003Cspan class=\"hljs-string\"\u003E&#x27;pg_update_iam &amp;&amp; ~\u002Fcloud-sql-proxy uat-everything:asia-east1:ktw-uat --port=5434&#x27;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E套用 alias 設定：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-built_in\"\u003Esource\u003C\u002Fspan\u003E ~\u002F.zshrc\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"開啟 SQL proxy\" title=\"開啟 SQL proxy\"\u003E\u003Ca href=\"#開啟 SQL proxy\"\u003E開啟 SQL proxy\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Cp\u003E開啟 proxy，讓 DB 可被連線：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Epg_proxy_dev  \u003Cspan class=\"hljs-comment\"\u003E# 開啟 Dev 的 proxy\u003C\u002Fspan\u003E\npg_proxy_uat  \u003Cspan class=\"hljs-comment\"\u003E# 開啟 UAT 的 proxy\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"DBeaver 設定\" title=\"DBeaver 設定\"\u003E\u003Ca href=\"#DBeaver 設定\"\u003EDBeaver 設定\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Col\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ccode\u003EPort\u003C\u002Fcode\u003E 設為 \u003Ccode\u003E.pgpass\u003C\u002Fcode\u003E 中對應的 port\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ccode\u003EDB name\u003C\u002Fcode\u003E 依據環境命名（如 \u003Ccode\u003Edev\u003C\u002Fcode\u003E、\u003Ccode\u003Euat\u003C\u002Fcode\u003E）\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E選擇 PostgreSQL PgPass 模式和\u003Ccode\u003EUsername\u003C\u002Fcode\u003E 填入 emai\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E測試是否連線成功，無問題後，點擊 Finish\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FrJU9aRa-Zl.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E接著可執行 SQL 測試資料(依自己測試資料)是否正常返回：\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003ESELECT\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003EFROM\u003C\u002Fspan\u003E product.title\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cstrong\u003E補充：\u003C\u002Fstrong\u003E 設定 Default Schema\u003C\u002Fp\u003E\n\u003Cp\u003E可於 DBeaver 設定 default schema 後，簡化查詢語法：\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhackmd.io\u002F_uploads\u002FSylmTCpbbl.png\" alt=\"image\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003ESELECT\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003EFROM\u003C\u002Fspan\u003E title\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"後記\" title=\"後記\"\u003E\u003Ca href=\"#後記\"\u003E後記\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Cp\u003E連線方式比較：\u003C\u002Fp\u003E\n\u003Ch3\u003E使用帳號密碼連線（直連 GCP）\u003C\u002Fh3\u003E\n\u003Cp\u003E\u003Cstrong\u003E需求：\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EGCP DB 的 public IP\u003C\u002Fli\u003E\n\u003Cli\u003E使用者帳號與密碼\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E\u003Cstrong\u003E缺點：\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E存在資安風險，會洩露資料庫的真實 IP\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch3\u003E使用 Cloud SQL Proxy + Pgpass\u003C\u002Fh3\u003E\n\u003Cp\u003E\u003Cstrong\u003E流程：\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EDBeaver → 透過本地 \u003Ccode\u003E.pgpass\u003C\u002Fcode\u003E 連線\u003C\u002Fli\u003E\n\u003Cli\u003EProxy → 連接至 GCP Cloud SQL，使用 IAM token 驗證\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E\u003Cstrong\u003E優點：\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E不需暴露 GCP 資料庫 IP\u003C\u002Fli\u003E\n\u003Cli\u003E使用動態 Token，安全性更高\u003C\u002Fli\u003E\n\u003Cli\u003E可自動更新 Token，維護方便\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cblockquote\u003E\n\u003Ch3\u003EProxy\u003C\u002Fh3\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003EDbeaver ⇒ Pgpass：\u003C\u002Fp\u003E\n\u003Cp\u003E連接 dbeaver 到 local 設定\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EPgpass ⇒ GCP：\u003C\u002Fp\u003E\n\u003Cp\u003E連接 local 設定到 GCP\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EDbeaver : 設定 pgpass 方式，須與 pgpass port 設定一致\u003C\u002Fp\u003E\n\u003Cp\u003EPgpass：存放 gcp token 地方 + 設定 local db port\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n",toc:{title:b,subtitles:["安裝","Pgpass 設定","開啟 SQL proxy","DBeaver 設定","後記"]},wordCount:892}}}}(null,"Pgpass 連線 Dbeaver feat. GCP","2025-11-15T00:00:00.000Z"));