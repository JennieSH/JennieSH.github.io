{"info":{"title":"[Note] Inherited Widget","fileName":"inherited-widget","description":"Inherited Widget 是 Flutter 用於處理資料共享的方法之一。","createdAt":"2024-12-15T00:00:00.000Z","updatedAt":"2024-12-15T00:00:00.000Z","tags":["Flutter","Inherited Widget"]},"content":"<h6>tags: <code>Flutter</code>、<code>InheritedWidget</code></h6>\n<h1 id=\"[Note] Inherited Widget\" title=\"[Note] Inherited Widget\">[Note] Inherited Widget</h1>\n<h2 id=\"基本概念\" title=\"基本概念\"><a href=\"#基本概念\">基本概念</a></h2>\n<p><code>Inherited Widget</code> 是一個可以向下傳遞資料的 Widget，在特定父 widget 通過 <code>Inherited Widget</code> 共享了一份資料，就可以在其任意子 widget 中來獲取該共享的資料。</p>\n<p>下面會用簡單的範例來實作 <code>Inherited Widget</code>。</p>\n<h2 id=\"需求\" title=\"需求\"><a href=\"#需求\">需求</a></h2>\n<ul>\n<li>\n<p>點擊 <code>change color</code> 按鈕(<code>OutlinedButton</code>)會改變底下兩個 <code>GO PageX</code> 按鈕(<code>ElevatedButton</code>)的背景色<br />\n<img src=\"https://i.imgur.com/Yd8rTsF.png\" alt=\"\" /></p>\n</li>\n<li>\n<p>Widget Tree(同顏色為同一層)，右半部灰底，有另外抽成一個 widget(<code>RedirectButtons</code>)<br />\n<img src=\"https://i.imgur.com/lwFE6Ow.png\" alt=\"\" /></p>\n</li>\n</ul>\n<h2 id=\"實作\" title=\"實作\"><a href=\"#實作\">實作</a></h2>\n<blockquote>\n<p>範例原始碼：<a  href=\"https://github.com/JennieSH/flutter-appworks/tree/feature/inherited-widget\" target=\"_blank\" rel=\"noreferrer noopener\">Repo 網址</a></p>\n</blockquote>\n<h3>Step1. 創建一個 Inherited Widget 的 Class</h3>\n<p>新增 <code>TextColor</code> 檔案：</p>\n<ul>\n<li><code>TextColor</code> 繼承 <code>InheritedWidget</code></li>\n<li>定義 <code>Color? color</code> 屬性，需要在子 widget 共享的資料</li>\n<li>定義 <code>of</code> 方法，可以在子 widget 中取得共享的資料</li>\n<li>當 color 改變時候，<code>updateShouldNotify</code> 會通知子 widget tree 中，有依賴到 color 的 widget 重新 build</li>\n</ul>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// text_color.dart</span>\n\n<span class=\"hljs-comment\">// extend InheritedWidget</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TextColor</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">InheritedWidget</span> </span>{\n  TextColor({\n    <span class=\"hljs-keyword\">super</span>.key,\n    <span class=\"hljs-keyword\">required</span> <span class=\"hljs-keyword\">super</span>.child,\n    <span class=\"hljs-keyword\">required</span> <span class=\"hljs-keyword\">this</span>.color,\n  });\n\n  <span class=\"hljs-comment\">// shared data</span>\n  Color? color;\n\n  <span class=\"hljs-comment\">// return text color to widget</span>\n  <span class=\"hljs-keyword\">static</span> Color of(BuildContext context) {\n    <span class=\"hljs-keyword\">final</span> Color? textColor =\n        context.dependOnInheritedWidgetOfExactType&lt;TextColor&gt;()!.color;\n\n    <span class=\"hljs-keyword\">return</span> textColor!;\n  }\n\n<span class=\"hljs-comment\">// this will notify all child widgets when there is a changes</span>\n  <span class=\"hljs-meta\">@override</span>\n  <span class=\"hljs-built_in\">bool</span> updateShouldNotify(TextColor oldWidget) {\n    <span class=\"hljs-keyword\">return</span> color != oldWidget.color;\n  }\n}\n\n</code></pre>\n<h3>Step2. 使用 <code>InheritedWidgets</code> 實例，包覆父 Widget</h3>\n<ul>\n<li>使用 <code>TextColor</code> 包覆 Homepage 的 body</li>\n<li>傳入參數\n<ul>\n<li><code>color</code>：要共享的資料</li>\n<li><code>child</code>：會使用到共享資料的子 widget tree</li>\n</ul>\n</li>\n</ul>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// page_home.dart</span>\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">_HomePageState</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">State</span>&lt;<span class=\"hljs-title\">HomePage</span>&gt; </span>{\n  <span class=\"hljs-built_in\">int</span> _index = <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-built_in\">List</span>&lt;Color&gt; _colorList = [Colors.green, Colors.red, Colors.blue];\n\n  <span class=\"hljs-meta\">@override</span>\n  Widget build(BuildContext context) {\n    <span class=\"hljs-keyword\">return</span> Scaffold(\n      appBar: AppBar(\n        title: <span class=\"hljs-keyword\">const</span> Text(<span class=\"hljs-string\">&quot;InheritedWidget&quot;</span>),\n      ),\n      <span class=\"hljs-comment\">// create InheritedWidgets</span>\n      <span class=\"hljs-comment\">// when color in TextColor change, all child Widget changed</span>\n      <span class=\"hljs-comment\">// now let&#x27;s create a button for multiple color changing</span>\n      body: TextColor(\n        color: _colorList[_index % <span class=\"hljs-number\">3</span>],\n        child: Column(\n          mainAxisAlignment: MainAxisAlignment.center,\n          children: [\n            OutlinedButton.icon(\n              onPressed: () {\n                <span class=\"hljs-comment\">// press button to change color in list</span>\n                setState(() {\n                  _index++;\n                });\n              },\n              icon: <span class=\"hljs-keyword\">const</span> Icon(Icons.loop),\n              label: <span class=\"hljs-keyword\">const</span> Text(<span class=\"hljs-string\">&#x27;change color&#x27;</span>),\n            ),\n            <span class=\"hljs-keyword\">const</span> RedirectButtons(),\n          ],\n        ),\n      ),\n    );\n  }\n}\n</code></pre>\n<h3>Step2. 子 Widget 取得共享資料</h3>\n<ul>\n<li>透過 <code>of</code> 方法（<code>TextColor.of(context)</code>） 取得共享資料</li>\n</ul>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// redirect_buttons.dart</span>\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">_RedirectButtonsState</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">State</span>&lt;<span class=\"hljs-title\">RedirectButtons</span>&gt; </span>{\n  <span class=\"hljs-meta\">@override</span>\n  Widget build(BuildContext context) {\n    <span class=\"hljs-comment\">// receive data from TextColor</span>\n    <span class=\"hljs-keyword\">final</span> _color = TextColor.of(context);\n\n    <span class=\"hljs-keyword\">return</span> Row(\n      mainAxisAlignment: MainAxisAlignment.center,\n      children: [\n        ElevatedButton(\n            onPressed: () {\n              Navigator.of(context).push(\n                MaterialPageRoute(\n                  builder: (context) =&gt; PageA(color: _color),\n                ),\n              );\n            },\n            style: ButtonStyle(\n              backgroundColor: MaterialStateProperty.all(_color),\n            ),\n            child: <span class=\"hljs-keyword\">const</span> Text(<span class=\"hljs-string\">&#x27;Go Page A&#x27;</span>)),\n        ...\n      ],\n    );\n  }\n}\n</code></pre>\n<h2 id=\"解決了什麼問題？\" title=\"解決了什麼問題？\"><a href=\"#解決了什麼問題？\">解決了什麼問題？</a></h2>\n<p>主要<strong>解決跨 widget 共享資料問題</strong>，以上面例子來看，一般做法會在 page 層定義變數 color，當最底下的 <code>ElevatedButton</code> 也需要使用到 color，color 會被當作 prop 一路往目標子 widget 傳遞：</p>\n<p><img src=\"https://i.imgur.com/ELK9pD5.png\" alt=\"\" /></p>\n<p>經過改寫過後，<code>RedirectButtons</code> 內部可以透過 <code>Inherited Widget</code> 直接拿到 page 層的 color 資料：</p>\n<p><img src=\"https://i.imgur.com/68GXFEM.png\" alt=\"\" /></p>\n<p>看似只節省一層傳遞（<code>RedirectButtons</code> 不需要再接收父層的 color），但如果現實 page 層和 <code>RedirectButtons</code> 中間隔了很多 widgets，且這些 widgets 也用不到變數 color，這功能就變得非常方便，因為大大<strong>解決 prop 傳遞過深問題</strong>。</p>\n<p><img src=\"https://i.imgur.com/B9fGCml.png\" alt=\"\" /></p>\n<h2 id=\"注意事項\" title=\"注意事項\"><a href=\"#注意事項\">注意事項</a></h2>\n<ol>\n<li><code>Inherited Widget</code> 只有在資料發生變化時才會進行更新，如果需要強制更新，可以使用 setState 或者其他方法來實現</li>\n<li>需要共享不同的資料，可以定義不同的 <code>Inherited Widget</code>，從而達到不同的共享資料的目的 (e.g. dialog 顯示狀態、toast 顯示狀態)</li>\n</ol>\n<h2 id=\"參考資料\" title=\"參考資料\"><a href=\"#參考資料\">參考資料</a></h2>\n<ul>\n<li><a  href=\"https://api.flutter.dev/flutter/widgets/InheritedWidget-class.html\" target=\"_blank\" rel=\"noreferrer noopener\">InheritedWidget class</a></li>\n<li><a  href=\"https://www.youtube.com/watch?v=tIAhnXXNB3w\" target=\"_blank\" rel=\"noreferrer noopener\">Flutter InheritedWidget</a></li>\n<li><a  href=\"https://book.flutterchina.club/chapter7/inherited_widget.html#_7-2-1-inheritedwidget\" target=\"_blank\" rel=\"noreferrer noopener\">數據共享（InheritedWidget）</a></li>\n</ul>\n","toc":{"title":"[Note] Inherited Widget","subtitles":["基本概念","需求","實作","解決了什麼問題？","注意事項","參考資料"]},"wordCount":735}