{"info":{"title":"[Debug] Flutter Image.network() åœ¨ Web ä¸‹ï¼Œåœ–ç‰‡æœƒè¼‰å…¥å¤±æ•—","fileName":"image-network-cors","description":"Flutter é–‹ç™¼ä¹‹è¸©å‘æ—¥è¨˜ï¼šåœ¨ web é–‹ç™¼æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ Image.network() åœ–ç‰‡æœƒè¼‰å…¥å¤±æ•—ã€‚","createdAt":"2024-04-14T00:00:00.000Z","updatedAt":"2024-04-14T00:00:00.000Z","tags":["Flutter","Image","Network","CORS"]},"content":"<h6>tags: <code>Flutter</code>ã€<code>Bug</code></h6>\n<h1 id=\"[Debug] Flutter Image.network() åœ¨ Web ä¸‹ï¼Œåœ–ç‰‡æœƒè¼‰å…¥å¤±æ•—\" title=\"[Debug] Flutter Image.network() åœ¨ Web ä¸‹ï¼Œåœ–ç‰‡æœƒè¼‰å…¥å¤±æ•—\">[Debug] Flutter Image.network() åœ¨ Web ä¸‹ï¼Œåœ–ç‰‡æœƒè¼‰å…¥å¤±æ•—</h1>\n<h2 id=\"å•é¡Œ\" title=\"å•é¡Œ\"><a href=\"#å•é¡Œ\">å•é¡Œ</a></h2>\n<p><img src=\"https://i.imgur.com/qpnv0hu.jpg\" alt=\"\" /></p>\n<p>ä½¿ç”¨ <code>Image.network()</code>ï¼Œæœƒè·‘å‡ºä¸‹é¢çš„éŒ¯èª¤è¨Šæ¯ï¼Œè€Œä¸”åªåœ¨ web ä¸‹æ‰æœƒå‡ºç¾ï¼Œåœ¨ iOS/Android åœ–ç‰‡éƒ½æœƒé †åˆ©é¡¯ç¤ºã€‚</p>\n<blockquote>\n<p>â•â•â•¡ EXCEPTION CAUGHT BY IMAGE RESOURCE SERVICE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br />\nThe following ImageCodecException was thrown resolving an image codec:<br />\nFailed to load network image.<br />\nImage URL: https:â€¦<br />\nTrying to load an image from another domain? Find answers at:<br />\n<a  href=\"https://flutter.dev/docs/development/platform-integration/web-images\" target=\"_blank\" rel=\"noreferrer noopener\">https://flutter.dev/docs/development/platform-integration/web-images</a><br />\nWhen the exception was thrown, this was the stack<br />\nImage provider: NetworkImage(â€œhttps://â€¦â€, scale:1)<br />\nImage key: NetworkImage(â€œhttps://â€¦â€, scale: 1)</p>\n</blockquote>\n<h2 id=\"åŸå› \" title=\"åŸå› \"><a href=\"#åŸå› \">åŸå› </a></h2>\n<!--\n~~åœ¨ [Github issue](https://github.com/flutter/flutter/issues/73327#issuecomment-764646411) æœ‰çœ‹åˆ°ç›¸é—œè¨è«–ï¼Œç›®å‰æ¨æ¸¬æ˜¯ CanvasKit å•é¡Œï¼Œå› ç‚º `Web renderers` é è¨­å€¼ç‚º `auto`ã€‚~~\n\n -->\n<p>ä¸»è¦åŸå› æ‡‰è©²æ˜¯ <a  href=\"https://github.com/flutter/flutter/issues/73109#issuecomment-790628014\" target=\"_blank\" rel=\"noreferrer noopener\">CORS å•é¡Œ</a>ï¼Œå®ƒå¯èƒ½æœƒå—åˆ°æ‰€ä½¿ç”¨çš„ web renderer å½±éŸ¿ï¼Œè§£æ±ºæ–¹å‘ä¸»è¦æœ‰ä¸‰å€‹ï¼š</p>\n<ol>\n<li>ç¬¬ä¸€å€‹ç›´æ¥è§£æ±ºæ ¹æœ¬çš„ CORS å•é¡Œï¼Œéœ€è¦è«‹å¾Œç«¯å”åŠ©ä¿®æ”¹ headers ç›¸é—œè¨­å®š</li>\n<li>ä½¿ç”¨ä»£ç†æœå‹™å™¨ï¼š è¨­ç½®ä¸€å€‹ä»£ç†æœå‹™å™¨ä¾†è½‰ç™¼ client è«‹æ±‚</li>\n<li>ç¬¬äºŒå€‹æ–¹å‘å°±æ˜¯ä¿®æ”¹ web renderer è¨­å®šï¼Œä¸‹é¢è§£æ³•åŸºæœ¬æ˜¯åœç¹çš„ç¬¬äºŒå€‹æ–¹å‘å»è§£çš„ã€‚\n<blockquote>\n<p>The HTML renderer can load cross-origin images without extra configuration. so you could use these commands to run and build the app</p>\n</blockquote>\n</li>\n</ol>\n<br/>\n<p>ç•¶ <code>--web-renderer=auto</code>(é è¨­å€¼)ï¼Œæœƒæ ¹æ“šä½¿ç”¨è€…çš„è£ç½®ï¼Œè‡ªå‹•é¸æ“‡æœ€é©åˆçš„ rendererï¼Œåœ¨ desktop browser ä¸‹ï¼Œé è¨­ä½¿ç”¨çš„å°±æ˜¯ CanvasKitï¼Œéœ€è¦æŒ‡å®šæˆ <code>html</code>ï¼Œæ‰èƒ½è§£æ±ºã€‚</p>\n<div class=\"info\">\n<p>ğŸ’¡ <strong>Flutter åœ¨ <a  href=\"https://docs.flutter.dev/development/platform-integration/web/renderers#command-line-options\" target=\"_blank\" rel=\"noreferrer noopener\">Web å¹³å°ä¸Šçš„æ¸²æŸ“å¼•æ“è¨­å®š</a>ï¼Œæœ‰ä¸‰ç¨®å¯é¸æ“‡ï¼š</strong></p>\n<ul>\n<li><strong><code>html</code></strong>ï¼šä½¿ç”¨ç€è¦½å™¨åŸç”Ÿçš„ HTMLã€CSSã€JavaScript ä¾†æ¸²æŸ“æ‡‰ç”¨ç¨‹å¼ï¼Œ<strong>æ”¯æ´æœ€å»£æ³›ä½†æ•ˆèƒ½è¼ƒå·®</strong>ã€‚</li>\n<li><strong><code>canvaskit</code></strong>ï¼šä½¿ç”¨ Skia Graphics Engine å°‡ Flutter ç•«é¢è½‰æ›æˆ Canvas å…ƒç´ ï¼Œç›¸è¼ƒæ–¼ html æœ‰è¼ƒå¥½çš„æ•ˆèƒ½ï¼Œä½†ç›¸å®¹æ€§è¼ƒå·®ã€‚</li>\n<li><strong><code>auto</code></strong>ï¼šæ ¹æ“šç€è¦½å™¨çš„æ”¯æ´åº¦è‡ªå‹•é¸æ“‡æ¸²æŸ“å¼•æ“ï¼Œé è¨­ç‚º canvaskitï¼Œä½†è‹¥ç€è¦½å™¨æ”¯æ´åº¦è¶³å¤ é«˜å‰‡æœƒè‡ªå‹•åˆ‡æ›ç‚º htmlã€‚</li>\n</ul>\n</div>\n<h2 id=\"è§£æ±ºæ–¹æ³•\" title=\"è§£æ±ºæ–¹æ³•\"><a href=\"#è§£æ±ºæ–¹æ³•\">è§£æ±ºæ–¹æ³•</a></h2>\n<h3>æ–¹æ³•ä¸€ï¼šä¿®æ”¹ Flutter è¨­å®šæª”ï¼ˆä¸€å‹æ°¸é€¸ï¼‰</h3>\n<p>æ‰¾åˆ° web è³‡æ–™å¤¾åº•ä¸‹çš„ <code>index.html</code> æª”æ¡ˆï¼Œåœ¨ initializeEngine è¨­å®šä¸­åŠ å…¥<code>renderer:'html'</code>ï¼Œä¹‹å¾Œä¸è«–æ˜¯ç”¨ VS code debugging æˆ–è€…çµ‚ç«¯æ©Ÿä¸‹ <code>flutter run --debug -d chrome</code>ï¼Œéƒ½å¯ä»¥é †åˆ©çœ‹åˆ°åœ–ç‰‡äº†ã€‚</p>\n<pre class=\"hljs\"><code>// index.html\n\n<span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">html</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span> ... <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">\n    <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;load&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">ev</span>) {\n      _flutter.<span class=\"hljs-property\">loader</span>.<span class=\"hljs-title function_\">loadEntrypoint</span>({\n        <span class=\"hljs-attr\">serviceWorker</span>: {\n          <span class=\"hljs-attr\">serviceWorkerVersion</span>: serviceWorkerVersion,\n        },\n        <span class=\"hljs-attr\">onEntrypointLoaded</span>: <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">engineInitializer</span>) {\n          engineInitializer.<span class=\"hljs-title function_\">initializeEngine</span>({\n            <span class=\"hljs-attr\">renderer</span>:<span class=\"hljs-string\">&#x27;html&#x27;</span> <span class=\"hljs-comment\">// é€™é‚ŠæŒ‡å®š renderer</span>\n          }).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">appRunner</span>) {\n            appRunner.<span class=\"hljs-title function_\">runApp</span>();\n          });\n        }\n      });\n    });\n  </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span>\n</code></pre>\n<p><img src=\"https://i.imgur.com/6UOb2Ot.png\" alt=\"\" /></p>\n<p><img src=\"https://i.imgur.com/JSSHPih.jpg\" alt=\"\" /></p>\n<br/>\n<h3>æ–¹æ³•äºŒï¼špassing flag (é©åˆæ…£ç”¨ Terminal debugging çš„äºº)</h3>\n<p>å°‡æŒ‡ä»¤å¾Œé¢å¤šåŠ  <code>--web-renderer html</code>ï¼Œç¼ºé»æ˜¯æ¯æ¬¡éƒ½è¦æ‰“é€™æ®µ</p>\n<pre class=\"hljs\"><code><span class=\"hljs-variable\">$flutter</span> run -d chrome --web-renderer html\n</code></pre>\n<br/>\n<h3>æ–¹æ³•ä¸‰ï¼šä¿®æ”¹ VS code è¨­å®šæª” (é©åˆæ…£ç”¨ VS code debugging çš„äºº)</h3>\n<p>å› ç‚ºæ˜¯é‡å° VS code è¨­å®šï¼Œæ‰€ä»¥ç¼ºé»ä¹Ÿå¾ˆæ˜é¡¯ï¼Œå°‡ä¾†å¦‚æœä¸æ˜¯é€é VS code run debugging (e.g. é€é Terminal)ï¼Œåœ–ç‰‡ä¾èˆŠæœƒè·‘ä¸å‡ºä¾†ï¼›å„ªé»å‰‡æ˜¯åªè¦è¨­å®šä¸€æ¬¡å³å¯ï¼Œè€Œä¸”å¯ä»¥ä¾æ“šéœ€æ±‚ï¼Œé¸æ“‡è¦ by å°ˆæ¡ˆæˆ–è€…æ˜¯ by User å»åšè¨­ç½®ã€‚</p>\n<br/>\n<p>ä¸‹é¢å…©ç¨®ä½œæ³•æ“‡ä¸€å³å¯ï¼Œæ•ˆæœä¸€æ¨£ï¼š</p>\n<ul>\n<li>\n<h4><code>ç›´æ¥æ–°å¢è¨­å®šæª”</code></h4>\n</li>\n</ul>\n<p>åœ¨å°ˆæ¡ˆåº•ä¸‹ï¼Œæ–°å¢ <code>.vscode</code> è³‡æ–™å¤¾å’Œ <code>settings.json</code> æª”æ¡ˆï¼Œæª”æ¡ˆå…§å®¹ç‚ºï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">&quot;dart.flutterWebRenderer&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;html&quot;</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p><img src=\"https://i.imgur.com/H4kkBzv.png\" alt=\"\" /></p>\n<ul>\n<li>\n<h4><code>é€é GUI</code></h4>\n</li>\n</ul>\n<p>å¾å·¦ä¸‹é½’è¼ªï¼Œæ‰¾åˆ° <code>Settings</code>ï¼Œç„¶å¾Œæœå°‹ <code>flutter renderer</code>ï¼Œå°‡åŸæœ¬ <code>Dart: Flutter Web Renderer</code> ç”±é è¨­çš„ <code>auto</code> æ”¹ç‚º <code>html</code>ã€‚</p>\n<p><img src=\"https://i.imgur.com/Qv0wTYY.png\" alt=\"\" /></p>\n<h2 id=\"åƒè€ƒè³‡æ–™\" title=\"åƒè€ƒè³‡æ–™\"><a href=\"#åƒè€ƒè³‡æ–™\">åƒè€ƒè³‡æ–™</a></h2>\n<ul>\n<li><a  href=\"https://github.com/flutter/flutter/issues/73109\" target=\"_blank\" rel=\"noreferrer noopener\">Image.network() doesnâ€™t show some images on the web but works on android.</a></li>\n<li><a  href=\"https://github.com/flutter/flutter/issues/73327\" target=\"_blank\" rel=\"noreferrer noopener\">[web]: NetworkImage crash while loading images</a></li>\n<li><a  href=\"https://github.com/Dart-Code/Dart-Code/pull/3000#issue-535900813\" target=\"_blank\" rel=\"noreferrer noopener\">Add a setting to easily set Flutterâ€™s web renderer in user/workspace settings</a></li>\n<li><a  href=\"https://github.com/LunaGao/flag_flutter/issues/49#issuecomment-803008314\" target=\"_blank\" rel=\"noreferrer noopener\">Capture from onError ImageCodecException</a></li>\n<li><a  href=\"https://docs.flutter.dev/development/platform-integration/web/renderers\" target=\"_blank\" rel=\"noreferrer noopener\">Web renderers</a></li>\n<li><a  href=\"https://stackoverflow.com/questions/65653801/flutter-web-cant-load-network-image-from-another-domain\" target=\"_blank\" rel=\"noreferrer noopener\">Flutter web canâ€™t load network image from another domain</a></li>\n</ul>\n","toc":{"title":"[Debug] Flutter Image.network() åœ¨ Web ä¸‹ï¼Œåœ–ç‰‡æœƒè¼‰å…¥å¤±æ•—","subtitles":["å•é¡Œ","åŸå› ","è§£æ±ºæ–¹æ³•","åƒè€ƒè³‡æ–™"]}}