{"info":{"title":"同源政策 Same-Origin Policy","fileName":"same-origin-policy","description":"為什麼要有同源政策？來一起探討背後原因","createdAt":"2025-02-17T00:00:00.000Z","updatedAt":"2025-02-17T00:00:00.000Z","tags":["Network","同源政策","CORS","Browser"]},"content":"<h6>tags: <code>Network</code> <code>同源政策</code> <code>CORS</code> <code>Browser</code></h6>\n<h1 id=\"同源政策 Same-Origin Policy\" title=\"同源政策 Same-Origin Policy\">同源政策 Same-Origin Policy</h1>\n<h3>Why</h3>\n<p>防止<strong>CSRF 誇站請求偽造</strong>(Cross-site request forgery) :</p>\n<p>利用了 web 中用戶身分驗證的一個漏洞：簡單的身分驗證只能保證請求發自某個用戶的瀏覽器，卻不能保證請求本身是用戶自願發出的。</p>\n<h3>Rules</h3>\n<ul>\n<li>相同協議(protocol)</li>\n<li>相同網域(domain)</li>\n<li>相同端口(port)</li>\n</ul>\n<h3>Method</h3>\n<h4>==CORS==</h4>\n<p>幾乎不太可能跟要接的 API 在同一 domain 下，所以為了讓不同源之間可以傳輸資料，又有另外一個規範叫 CORS。</p>\n<p>CORS 把請求分為兩種，簡單請求跟預檢(preflight)請求。</p>\n<blockquote>\n<p>Server 必須在 Response 的 Header 裡面加上 Access-Control-Allow-Origin 的設定。</p>\n</blockquote>\n<ul>\n<li><strong>簡單請求</strong><br />\n要滿足所有<a  href=\"https://developer.mozilla.org/zh-TW/docs/Web/HTTP/CORS#%E7%B0%A1%E5%96%AE%E8%AB%8B%E6%B1%82\" target=\"_blank\" rel=\"noreferrer noopener\">判斷條件</a>，最容易分辨的是沒有自定義 Header，而且又是 GET 。</li>\n</ul>\n<pre class=\"hljs\"><code><span class=\"hljs-variable constant_\">GET</span> <span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//api.users.com/user/1 HTTP/1.1</span>\n</code></pre>\n<ul>\n<li><strong>預檢(preflight)請求</strong></li>\n</ul>\n<p>瀏覽器會先送出 HTTP 的 OPTIONS 方法，確認 Server 的 Response 是否有 Access- Control-Allow-Origin ，確認有之後才會把我們的請求送出。</p>\n<div class=\"info\">\n<p>OPTIONS 是一個 HTTP/1.1 方法，這個方法用來確認來自伺服器進一步的資訊，重複執行不會造成任何影響</p>\n</div>\n<pre class=\"hljs\"><code>\n<span class=\"hljs-keyword\">const</span> xhr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">XMLHttpRequest</span>()\nxhr.<span class=\"hljs-title function_\">open</span>(<span class=\"hljs-string\">&quot;POST&quot;</span>,<span class=\"hljs-string\">&quot;http://api&quot;</span>) <span class=\"hljs-comment\">//用post方法發請求到api網址</span>\n  xhr.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&#x27;readystatechange&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">e</span>) {\n    <span class=\"hljs-keyword\">if</span> (e.<span class=\"hljs-property\">target</span>.<span class=\"hljs-property\">readyState</span> === <span class=\"hljs-number\">4</span> &amp;&amp; e.<span class=\"hljs-property\">target</span>.<span class=\"hljs-property\">status</span> === <span class=\"hljs-number\">200</span>) {\n      <span class=\"hljs-comment\">//....</span>\n\n    } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (e.<span class=\"hljs-property\">target</span>.<span class=\"hljs-property\">readyState</span> === <span class=\"hljs-number\">4</span>) {\n      <span class=\"hljs-comment\">//....</span>\n    }\n  });\n  xhr.<span class=\"hljs-title function_\">setRequestHeader</span>(<span class=\"hljs-string\">&quot;Content-Type&quot;</span>, <span class=\"hljs-string\">&quot;application/json&quot;</span>);\n  xhr.<span class=\"hljs-title function_\">send</span>();\n\n</code></pre>\n<h2 id=\"參考資料\" title=\"參考資料\"><a href=\"#參考資料\">參考資料</a></h2>\n<ul>\n<li><a  href=\"https://developer.mozilla.org/zh-TW/docs/Web/HTTP/CORS\" target=\"_blank\" rel=\"noreferrer noopener\">MDN 跨來源資源共享（CORS）</a></li>\n<li><a  href=\"https://ithelp.ithome.com.tw/articles/10205069\" target=\"_blank\" rel=\"noreferrer noopener\">Web Server - 跨域請求</a></li>\n</ul>\n","toc":{"title":"同源政策 Same-Origin Policy","subtitles":["參考資料"]},"wordCount":261}