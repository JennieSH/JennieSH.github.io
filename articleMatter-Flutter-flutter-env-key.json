{"info":{"title":"[Note] Flutter å¦‚ä½•éš±è— API Key","fileName":"flutter-env-key","description":"ä»‹ç´¹ Flutter å¸¸è¦‹çš„ API keys ä½¿ç”¨æ–¹æ³•ï¼Œä¸»è¦æœ‰ä¸‰ç¨®ï¼Œå¯ä»¥ä¾æƒ…å¢ƒé¸æ“‡éœ€è¦çš„æ–¹å¼ã€‚","createdAt":"2023-05-12T00:00:00.000Z","updatedAt":"2023-05-12T00:00:00.000Z","tags":["Flutter","env","key"]},"content":"<h6>tags: <code>Flutter</code>ã€<code>env</code>ã€<code>key</code></h6>\n<h1 id=\"[Note] Flutter å¦‚ä½•éš±è— API Key\" title=\"[Note] Flutter å¦‚ä½•éš±è— API Key\">[Note] Flutter å¦‚ä½•éš±è— API Key</h1>\n<h2 id=\"å‰è¨€\" title=\"å‰è¨€\"><a href=\"#å‰è¨€\">å‰è¨€</a></h2>\n<p>ä»‹ç´¹ Flutter å¸¸è¦‹çš„ API keys ä½¿ç”¨æ–¹æ³•ï¼Œä¸»è¦æœ‰ä¸‰ç¨®ï¼Œå¯ä»¥ä¾æƒ…å¢ƒé¸æ“‡éœ€è¦çš„æ–¹å¼ã€‚</p>\n<p>å…§æ–‡ä¸»è¦æ˜¯ä¾ç…§ <a  href=\"https://codewithandrea.com/articles/flutter-api-keys-dart-define-env-files/\" target=\"_blank\" rel=\"noreferrer noopener\">How to Store API Keys in Flutter</a> æ•´ç†å‡ºçš„æ–¹æ³•ï¼Œæ–‡ç« å¯«å¾—å¾ˆè©³ç´°ï¼Œéå¸¸æ¨è–¦é–±è®€ ğŸ‘</p>\n<h2 id=\"Hard-coding\" title=\"Hard-coding\"><a href=\"#Hard-coding\">Hard-coding</a></h2>\n<p>ç›´æ¥æŠŠ key å€¼å¯«åœ¨ <code>.dart</code> æª”æ¡ˆä¸­ã€‚</p>\n<p>å…ˆåœ¨ <code>api_key.dart</code> æ–°å¢ API keyï¼Œåœ¨éœ€è¦ä½¿ç”¨çš„æª”æ¡ˆä¸­ï¼Œå¼•å…¥ <code>api_key.dart</code>ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// api_key.dart</span>\n<span class=\"hljs-keyword\">final</span> apiKey = <span class=\"hljs-string\">&#x27;AIzaSyBeSYQ8cn6IIwRBbB4hPrn&#x27;</span>;\n</code></pre>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// Step 1. import key æ‰€åœ¨çš„æª”æ¡ˆ</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&#x27;api_key.dart&#x27;</span>;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">LocationService</span> </span>{\n  Future&lt;<span class=\"hljs-built_in\">String</span>&gt; getPlaceId(<span class=\"hljs-built_in\">String</span> input) <span class=\"hljs-keyword\">async</span> {\n     <span class=\"hljs-comment\">// Step 2.ç›´æ¥ä½¿ç”¨ key å€¼</span>\n    <span class=\"hljs-keyword\">final</span> <span class=\"hljs-built_in\">String</span> url =\n        <span class=\"hljs-string\">&#x27;https://maps.googleapis.com/maps/api/place/findplacefromtext/json?input=<span class=\"hljs-subst\">$input</span>&amp;inputtype=textquery&amp;key=<span class=\"hljs-subst\">$apiKey</span>&#x27;</span>;\n\n    <span class=\"hljs-keyword\">var</span> response = <span class=\"hljs-keyword\">await</span> http.<span class=\"hljs-keyword\">get</span>(<span class=\"hljs-built_in\">Uri</span>.parse(url));\n    <span class=\"hljs-keyword\">var</span> json = convert.jsonDecode(response.body);\n\n    <span class=\"hljs-keyword\">var</span> placeId = json[<span class=\"hljs-string\">&#x27;candidates&#x27;</span>][<span class=\"hljs-number\">0</span>][<span class=\"hljs-string\">&#x27;place_id&#x27;</span>] <span class=\"hljs-keyword\">as</span> <span class=\"hljs-built_in\">String</span>;\n    <span class=\"hljs-keyword\">return</span> placeId;\n  }\n\n}\n</code></pre>\n<p>éœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ï¼Œ<strong>åƒè¬ä¸è¦æŠŠ <code>api_key.dart</code> commit é€² git</strong>ï¼Œéœ€è¦å¦å¤–æŠŠ <code>api_key.dart</code> åŠ å…¥ <code>.gitignore</code> æª”æ¡ˆä¸­ï¼š</p>\n<pre class=\"hljs\"><code># åœ¨ .gitignore ä¸­çš„æª”æ¡ˆï¼Œéƒ½ä¸æœƒé€²å…¥ git ç‰ˆæ§ç´€éŒ„\napi_key.dart\n</code></pre>\n<h3>å„ªé»</h3>\n<ul>\n<li>å¿«é€Ÿä½¿ç”¨</li>\n</ul>\n<h3>ç¼ºé»</h3>\n<ul>\n<li>ç„¡æ³•æ ¹æ“šç’°å¢ƒå» mapping å°æ‡‰çš„ key</li>\n<li>key ä»¥æ˜æ–‡æ–¹å¼å„²å­˜(plaintext)ï¼Œå®‰å…¨æ€§ä¸é«˜</li>\n<li>å¯èƒ½æœƒå› å¤±èª¤ï¼Œé€ æˆ key å€¼å¤–æ´© e.g. å¿˜è¨˜åŠ é€² <code>.gitignore</code></li>\n</ul>\n<div class=\"warning\">\n<p>âš ï¸ <strong>æé†’ï¼š</strong></p>\n<p><code>api_key.dart</code> å¦‚æ›¾ç¶“è¢« commit é€² gitï¼Œå¾ŒçºŒå†æŠŠå®ƒåŠ å…¥åˆ° <code>.gitignore</code>ï¼Œä¹Ÿæ²’ç”¨ï¼Œå› ç‚ºéƒ½å¯ä»¥åœ¨ git history æ‰¾åˆ°ç›¸é—œ key è³‡è¨Šï¼Œå”¯ä¸€èƒ½åšçš„å°±æ˜¯éŠ·æ¯€åŸå…ˆçš„ keyï¼Œå†æ–°å¢ä¸€å€‹æ–°çš„ã€‚</p>\n</div>\n<h2 id=\"â€“dart-define / --dart-define-from-file\" title=\"â€“dart-define / --dart-define-from-file\"><a href=\"#â€“dart-define / --dart-define-from-file\">â€“dart-define / --dart-define-from-file</a></h2>\n<p>åœ¨ç·¨è­¯éšæ®µï¼Œä½¿ç”¨ <code>--dart-define</code> æˆ– <code>--dart-define-from-file</code> å°‡ key å‚³å…¥ç¨‹å¼ä¸­ä½¿ç”¨ã€‚</p>\n<h3>â€“dart-define</h3>\n<p>åœ¨ç¨‹å¼ä¸­ä½¿ç”¨ <code>String.fromEnvironment(&lt;key-name&gt;)</code> å–å¾— keyï¼Œä¸¦æ”¹ç”¨ä¸‹é¢æŒ‡ä»¤å» run ç¨‹å¼ï¼Œå°‡ key å‚³å…¥é€²ç¨‹å¼ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">LocationService</span> </span>{\n  Future&lt;<span class=\"hljs-built_in\">String</span>&gt; getPlaceId(<span class=\"hljs-built_in\">String</span> input) <span class=\"hljs-keyword\">async</span> {\n    <span class=\"hljs-comment\">// get api key</span>\n    <span class=\"hljs-keyword\">const</span> apiKey = <span class=\"hljs-built_in\">String</span>.fromEnvironment(<span class=\"hljs-string\">&#x27;API_KEY&#x27;</span>);\n    <span class=\"hljs-keyword\">if</span> (apiKey.isEmpty) {\n      <span class=\"hljs-keyword\">throw</span> AssertionError(<span class=\"hljs-string\">&#x27;API_KEY is not set&#x27;</span>);\n    }\n\n    <span class=\"hljs-comment\">// use api key</span>\n    <span class=\"hljs-keyword\">final</span> <span class=\"hljs-built_in\">String</span> url = <span class=\"hljs-string\">&#x27;https://maps.googleapis.com/maps/api/place/findplacefromtext/json?input=<span class=\"hljs-subst\">$input</span>&amp;inputtype=textquery&amp;key=<span class=\"hljs-subst\">$apiKey</span>&#x27;</span>;\n    ...\n}\n</code></pre>\n<pre class=\"hljs\"><code><span class=\"hljs-variable\">$flutter</span> run --dart-define API_KEY=AIzaSyBeSYQ8cn\n</code></pre>\n<h4>å„ªé»</h4>\n<ul>\n<li>source code ä¸æœƒå­˜åœ¨ Hard-coding key</li>\n</ul>\n<h4>ç¼ºé»</h4>\n<ul>\n<li>\n<p>è¤‡æ•¸ keys æ™‚ï¼Œé›£ä»¥ç®¡ç†</p>\n<pre class=\"hljs\"><code><span class=\"hljs-variable\">$flutter</span> run \\\n  --dart-define A_API_KEY= ... \\\n  --dart-define B_API_KEY= ... \\\n  --dart-define C_API_KEY= ...\n</code></pre>\n</li>\n<li>\n<p>åœ¨ç·¨è­¯å¾Œï¼Œkey ä»ç„¶æœƒè¢«åµŒå…¥åˆ°ç™¼ä½ˆç‰ˆæœ¬ï¼ˆrelease binaryï¼‰çš„äºŒé€²åˆ¶æ–‡ä»¶ä¸­</p>\n<blockquote>\n<p>é‡å°ç™¼ä½ˆç‰ˆæœ¬ï¼ˆrelease binaryï¼‰éœ€è¦å° Dart ä»£ç¢¼é€²è¡Œæ··æ·†ï¼ˆæ··æ·†å¯ä»¥è®“ä»£ç¢¼é›£ä»¥è¢«ç†è§£å’Œè§£è®€ï¼‰ï¼Œé™ä½è¢«åå‘ç ´è­¯çš„é¢¨éšªï¼Œå¯ä»¥åƒè€ƒ<a  href=\"https://docs.flutter.dev/deployment/obfuscate\" target=\"_blank\" rel=\"noreferrer noopener\">å®˜æ–¹æ¨è–¦åšæ³•</a>ã€‚</p>\n</blockquote>\n</li>\n</ul>\n<br/>\n<h3><code>--dart-define-from-file</code></h3>\n<p>åœ¨ <code>Flutter 3.7</code> å¾Œï¼Œå¯ä»¥å°‡ API keys å­˜æˆä¸€å€‹ json æª”æ¡ˆï¼ˆéœ€è¦é€² <code>.gitignore</code>ï¼‰ï¼Œå†æ”¹ç”¨ä¸‹é¢æŒ‡ä»¤å» run ç¨‹å¼ï¼Œå°‡ json å…§å®¹å‚³å…¥é€²ç¨‹å¼ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// api-keys.json</span>\n<span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">&quot;GOOGLE_MAP_KEY&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;...&quot;</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;A_API_KEY&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;...&quot;</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;B_API_KEY&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;...&quot;</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<pre class=\"hljs\"><code><span class=\"hljs-variable\">$flutter</span> run --dart-define-from-file=api-keys.json\n</code></pre>\n<p>ç¨‹å¼ä¸­ä¸€æ¨£ä½¿ç”¨ <code>String.fromEnvironment(&lt;key-name&gt;)</code> å–å¾— key å€¼ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-keyword\">const</span> apiKey = <span class=\"hljs-built_in\">String</span>.fromEnvironment(<span class=\"hljs-string\">&#x27;GOOGLE_MAP_KEY&#x27;</span>);\n<span class=\"hljs-keyword\">if</span> (apiKey.isEmpty) {\n  <span class=\"hljs-comment\">// handle error</span>\n}\n\n<span class=\"hljs-comment\">// use api key</span>\n...\n</code></pre>\n<br/>\n<h4><code>--dart-define-from-file</code> èˆ‡ <code>launch.json</code> çµ„åˆæŠ€ (VSCode)</h4>\n<p>åœ¨ <code>.vscode/launch.json</code> ä¸­çš„ <code>args</code>(æœƒä»£å…¥åœ¨ command line)ï¼ŒåŠ å…¥ä¸‹åˆ—åƒæ•¸ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// .vscode/launch.json</span>\n<span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">&quot;version&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0.2.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;configurations&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;Launch Development&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;request&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;launch&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;dart&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;program&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;lib/main.dart&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-comment\">// add here</span>\n      <span class=\"hljs-attr\">&quot;args&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;--dart-define-from-file&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;api-keys.json&quot;</span><span class=\"hljs-punctuation\">]</span>\n    <span class=\"hljs-punctuation\">}</span>\n  <span class=\"hljs-punctuation\">]</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p>ä¹Ÿå¯ä»¥é‡å°ç’°å¢ƒï¼Œæœ‰ä¸ä¸€æ¨£çš„ API keysï¼Œi.e. Production ç’°å¢ƒä½¿ç”¨ <code>api-keys.prod.json</code>ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// .vscode/launch.json</span>\n<span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">&quot;version&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0.2.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;configurations&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;Launch Development&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;request&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;launch&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;dart&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;program&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;lib/main.dart&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;args&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;--dart-define-from-file&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;api-keys.json&quot;</span><span class=\"hljs-punctuation\">]</span>\n    <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;Launch Production&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;request&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;launch&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;dart&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;program&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;lib/main.dart&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;args&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;--dart-define-from-file&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;api-keys.prod.json&quot;</span><span class=\"hljs-punctuation\">]</span>\n    <span class=\"hljs-punctuation\">}</span>\n  <span class=\"hljs-punctuation\">]</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<details class='spoiler'><summary>é—œæ–¼ launch.json(çµ„æ…‹æª”)</summary>\n<p><strong><code>launch.json</code></strong> æ˜¯å®šç¾©èª¿è©¦éç¨‹ä¸­æ‰€éœ€çš„å„ç¨®è¨­å®šï¼Œå¦‚ç¨‹å¼å…¥å£ã€å‘½ä»¤åˆ—åƒæ•¸ã€ç’°å¢ƒè®Šæ•¸ç­‰ã€‚</p>\n<p>é™¤äº†æ‰‹å‹•æ–°å¢æª”æ¡ˆï¼Œä¹Ÿå¯ä»¥é€é VSCode è‡ªå‹•ç”Ÿæˆä¸€å€‹ï¼Œé»é¸ <code>Run and Debug</code> &gt; <code>create a launch.json file</code> &gt; <code>Dart &amp; Flutter</code>ï¼š</p>\n<p><img src=\"https://hackmd.io/_uploads/HydUmehE2.png\" alt=\"\" /></p>\n<p>æ–°å¢çš„æª”æ¡ˆå…§å®¹èˆ‡ä¸Šé¢ç¯„ä¾‹æœ‰é»ä¸åŒï¼Œå› ç‚ºé€™ä»½æª”æ¡ˆæŠŠ <a  href=\"https://docs.flutter.dev/testing/build-modes\" target=\"_blank\" rel=\"noreferrer noopener\">flutterMode</a> ä¸‰å€‹é‹è¡Œæ¨¡å¼(<code>debug</code>/<code>profile</code>/<code>release</code>) éƒ½åˆ—å‡ºä¾†äº†ï¼Œè¦åŠ ä¸Šå„å€‹ç’°å¢ƒ keys çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// .vscode/launch.json</span>\n<span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">&quot;version&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0.2.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;configurations&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;flutter-appworks&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;request&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;launch&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;dart&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;args&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;--dart-define-from-file&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;api-keys.json&quot;</span><span class=\"hljs-punctuation\">]</span>\n    <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;flutter-appworks (profile mode)&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;request&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;launch&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;dart&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;flutterMode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;profile&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;args&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;--dart-define-from-file&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;api-keys.json&quot;</span><span class=\"hljs-punctuation\">]</span>\n    <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;flutter-appworks (release mode)&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;request&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;launch&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;dart&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;flutterMode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;release&quot;</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;args&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;--dart-define-from-file&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;api-keys.prod.json&quot;</span><span class=\"hljs-punctuation\">]</span>\n    <span class=\"hljs-punctuation\">}</span>\n  <span class=\"hljs-punctuation\">]</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p><strong>[è£œå…… QA]</strong><br />\nQ. <code>version</code> ç‚ºä»€éº¼æ˜¯ 0.2.0 å‘¢ï¼Ÿ</p>\n<blockquote>\n<p>ç›®å‰æ²’æ‰¾åˆ°ç¢ºåˆ‡ç‚ºä»€éº¼æœƒæ˜¯ 0.2.0 çš„åŸå› ï¼Œä½†<a  href=\"https://code.visualstudio.com/docs/editor/debugging#_launch-configurations\" target=\"_blank\" rel=\"noreferrer noopener\">å®˜ç¶²ç¯„ä¾‹</a>ä¹Ÿéƒ½æ˜¯ä½¿ç”¨ 0.2.0 ç‰ˆæœ¬ï¼Œæ‡‰è©²æ˜¯ç›®å‰ default å€¼ã€‚</p>\n<p>æœ€å¾Œä¹Ÿæœ‰è©¢å• chatGPTï¼ŒæŒ‡å‡ºå¦‚æœä½¿ç”¨çš„æ˜¯èˆŠç‰ˆæœ¬çš„ VSCode æˆ–å¸Œæœ›ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶èªæ³•ï¼Œå¯ä»¥å°‡ â€œversionâ€ æ›´æ”¹ç‚º â€œ0.1.0â€ æˆ–å…¶ä»–ç‰ˆæœ¬è™Ÿã€‚<br />\n:::</p>\n</blockquote>\n<br/>\n<div class=\"info\">\n<p>ğŸ’¡ <strong>è£œå……</strong><br />\nå¦‚æœæ˜¯ä½¿ç”¨å…¶ä»– IDEï¼Œä¾‹å¦‚ IntelliJ æˆ– Android Studioï¼Œå¯åƒè€ƒ <a  href=\"https://www.jetbrains.com/help/idea/run-debug-configuration.html\" target=\"_blank\" rel=\"noreferrer noopener\">Run/debug configurations</a>ã€‚</p>\n</div>\n</details>\n<h4>å„ªé»</h4>\n<ul>\n<li>æ–¹ä¾¿ç®¡ç†å¤šçµ„ keys</li>\n<li>å¯é‡å°ä¸åŒç’°å¢ƒ(dev/prod)ï¼Œè¨­ç½®ä¸åŒ key çš„ json æª”æ¡ˆ</li>\n</ul>\n<h4>ç¼ºé»</h4>\n<ul>\n<li>json æª”æ¡ˆéœ€è¦åŠ å…¥ <code>.gitignore</code> æ¸…å–®ä¸­ (json ä¸­çš„ key ä¹Ÿæ˜¯å±¬æ–¼ hardcode)</li>\n</ul>\n<h2 id=\".env æª”æ¡ˆå®šç¾© key\" title=\".env æª”æ¡ˆå®šç¾© key\"><a href=\"#.env æª”æ¡ˆå®šç¾© key\">.env æª”æ¡ˆå®šç¾© key</a></h2>\n<p>æŠŠ key å€¼çµ±ä¸€ç®¡ç†åœ¨ <code>.env</code> æª”æ¡ˆä¸­ï¼Œæœƒéœ€è¦é…åˆé¡å¤–çš„ packageï¼Œä¾‹å¦‚ï¼š <a  href=\"https://pub.dev/packages/envied\" target=\"_blank\" rel=\"noreferrer noopener\"><code>envied</code></a></p>\n<h3>Step 1. å®‰è£ <a  href=\"https://pub.dev/packages/envied\" target=\"_blank\" rel=\"noreferrer noopener\">envied</a> å¥—ä»¶</h3>\n<p><code>envied</code> å¯ä»¥å¹«åŠ©æˆ‘å€‘ç”Ÿæˆä¸€å€‹ Dart classï¼ŒåŒ…å« <code>.env</code> æª”æ¡ˆä¸­çš„å€¼ã€‚</p>\n<pre class=\"hljs\"><code>$ flutter pub add envied\n$ flutter pub add --dev envied_generator\n$ flutter pub add --dev build_runner\n</code></pre>\n<h3>Step 2. æ–°å¢ <code>.env</code></h3>\n<pre class=\"hljs\"><code># .env\nAPI_KEY=AIzaSyBeSYQ8cn6IIwRBbB4hPrn\n</code></pre>\n<h3>Step 3. æ–°å¢ <code>env.dart</code></h3>\n<p><code>env.g.dart</code> å¾Œé¢æœƒç”¨æŒ‡ä»¤ç”¢ç”Ÿï¼Œç›®å‰æœƒå ±éŒ¯ï¼Œå¯ä»¥å¿½ç•¥ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// lib/env.dart</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&#x27;package:envied/envied.dart&#x27;</span>;\n\n<span class=\"hljs-keyword\">part</span> <span class=\"hljs-string\">&#x27;env.g.dart&#x27;</span>;\n\n<span class=\"hljs-meta\">@Envied</span>(path: <span class=\"hljs-string\">&#x27;.env&#x27;</span>)\n<span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Env</span> </span>{\n  <span class=\"hljs-meta\">@EnviedField</span>(varName: <span class=\"hljs-string\">&#x27;API_KEY&#x27;</span>)\n  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">const</span> apiKey = _Env.apiKey;\n}\n</code></pre>\n<p>ä»¥ä¸Šå¯«æ³•å·²ç¶“è¶³å¤ ä½¿ç”¨äº†ï¼Œä½†ç‚ºäº†æé«˜å®‰å…¨æ€§ï¼Œå¯ä»¥ä½¿ç”¨å¥—ä»¶æä¾›çš„æ··æ·†(Obfuscation)åŠŸèƒ½ï¼Œéœ€è¦åœ¨ <code>@EnviedField</code> åŠ ä¸Š <code>obfuscate: true</code>ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// lib/env.dart</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&#x27;package:envied/envied.dart&#x27;</span>;\n\n<span class=\"hljs-keyword\">part</span> <span class=\"hljs-string\">&#x27;env.g.dart&#x27;</span>;\n\n<span class=\"hljs-meta\">@Envied</span>(path: <span class=\"hljs-string\">&#x27;.env&#x27;</span>)\n<span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Env</span> </span>{\n  <span class=\"hljs-comment\">// Add here</span>\n  <span class=\"hljs-meta\">@EnviedField</span>(varName: <span class=\"hljs-string\">&#x27;API_KEY&#x27;</span>, obfuscate: <span class=\"hljs-keyword\">true</span>)\n  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> apiKey = _Env.apiKey;\n}\n</code></pre>\n<div class=\"info\">\n<p>ğŸ’¡ <strong>è£œå……ï¼š</strong><br />\nå¦‚æœä½¿ç”¨ <code>obfuscate</code> flagï¼Œéœ€è¦å°‡ <code>const</code> æ”¹æˆ <code>final</code>ï¼Œå¦å‰‡æœƒå ±éŒ¯ã€‚</p>\n</div>\n<h3>Step 4. ç”¢ç”Ÿ <code>env.g.dart</code></h3>\n<pre class=\"hljs\"><code><span class=\"hljs-variable\">$flutter</span> pub run build_runner build --delete-conflicting-outputs\n</code></pre>\n<p>åŸ·è¡Œå®Œå¾Œï¼Œæœƒç”¢ç”Ÿä¸€ä»½ <code>env.g.dart</code>ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// GENERATED CODE - DO NOT MODIFY BY HAND</span>\n\n<span class=\"hljs-keyword\">part</span> of <span class=\"hljs-string\">&#x27;env.dart&#x27;</span>;\n\n<span class=\"hljs-comment\">// **************************************************************************</span>\n<span class=\"hljs-comment\">// EnviedGenerator</span>\n<span class=\"hljs-comment\">// **************************************************************************</span>\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">_Env</span> </span>{\n  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-built_in\">List</span>&lt;<span class=\"hljs-built_in\">int</span>&gt; _enviedkeyapiKey = [\n    <span class=\"hljs-number\">2433719592</span>,\n    <span class=\"hljs-number\">1273530568</span>,\n    ....\n  ];\n  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-built_in\">List</span>&lt;<span class=\"hljs-built_in\">int</span>&gt; _envieddataapiKey = [\n    <span class=\"hljs-number\">2433719657</span>,\n    <span class=\"hljs-number\">1273530497</span>,\n    ....\n  ];\n  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> apiKey = <span class=\"hljs-built_in\">String</span>.fromCharCodes(\n    <span class=\"hljs-built_in\">List</span>.generate(_envieddataapiKey.length, (i) =&gt; i, growable: <span class=\"hljs-keyword\">false</span>)\n        .map((i) =&gt; _envieddataapiKey[i] ^ _enviedkeyapiKey[i])\n        .toList(growable: <span class=\"hljs-keyword\">false</span>),\n  );\n}\n</code></pre>\n<div class=\"info\">\n<p>ğŸ’¡ <strong>è£œå……ï¼š</strong></p>\n<p>å¦‚æœä¸åœ¨ <code>@EnviedField</code> åŠ ä¸Š <code>obfuscate: true</code>ï¼Œç”¢å‡ºä¾†çš„ <code>env.g.dart</code> å…§å®¹å¦‚ä¸‹ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// GENERATED CODE - DO NOT MODIFY BY HAND</span>\n\n<span class=\"hljs-keyword\">part</span> of <span class=\"hljs-string\">&#x27;env.dart&#x27;</span>;\n\n<span class=\"hljs-comment\">// **************************************************************************</span>\n<span class=\"hljs-comment\">// EnviedGenerator</span>\n<span class=\"hljs-comment\">// **************************************************************************</span>\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">_Env</span> </span>{\n  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">const</span> apiKey = <span class=\"hljs-string\">&#x27;AIzaSyBeSYQ8cn6IIwRBbB4hPrn&#x27;</span>;\n}\n</code></pre>\n<p>é€™æ¨£ <code>apiKey</code> æœƒä»¥æ˜ç¢¼æ–¹å¼å­˜åœ¨æ–¼ dart æª”æ¡ˆä¸­ã€‚</p>\n</div>\n<h3>Step 5. å°‡ <code>*.env*</code> èˆ‡ <code>env.g.dart</code> åŠ å…¥ <code>.gitignore</code></h3>\n<p>é€™å…©ä»½æª”æ¡ˆåŸºæœ¬éƒ½æœ‰ key çš„è³‡è¨Šï¼Œéƒ½éœ€è¦åŠ å…¥ <code>.gitignore</code> å…§ï¼š</p>\n<pre class=\"hljs\"><code># .gitignore\nenv.g.dart\n*.env*\n</code></pre>\n<h3>Step 6. ç¨‹å¼å…§ä½¿ç”¨ API keys</h3>\n<p>å¼•å…¥ <code>env.dart</code> æª”æ¡ˆï¼Œä½¿ç”¨ <code>Env.&lt;key-name&gt;</code> å–å¾— key çš„å€¼ï¼š</p>\n<pre class=\"hljs\"><code><span class=\"hljs-comment\">// å¼•å…¥ env.dart</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&#x27;package:flutter_appworks/env.dart&#x27;</span>;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">LocationService</span> </span>{\n  <span class=\"hljs-comment\">// use api key</span>\n  <span class=\"hljs-keyword\">final</span> key = Env.apiKey;\n\n  Future&lt;<span class=\"hljs-built_in\">String</span>&gt; getPlaceId(<span class=\"hljs-built_in\">String</span> input) <span class=\"hljs-keyword\">async</span> {\n    <span class=\"hljs-keyword\">final</span> <span class=\"hljs-built_in\">String</span> url =\n        <span class=\"hljs-string\">&#x27;https://maps.googleapis.com/maps/api/place/findplacefromtext/json?input=<span class=\"hljs-subst\">$input</span>&amp;inputtype=textquery&amp;key=<span class=\"hljs-subst\">$key</span>&#x27;</span>;\n\n    <span class=\"hljs-keyword\">var</span> response = <span class=\"hljs-keyword\">await</span> http.<span class=\"hljs-keyword\">get</span>(<span class=\"hljs-built_in\">Uri</span>.parse(url));\n    <span class=\"hljs-keyword\">var</span> json = convert.jsonDecode(response.body);\n\n    <span class=\"hljs-keyword\">var</span> placeId = json[<span class=\"hljs-string\">&#x27;candidates&#x27;</span>][<span class=\"hljs-number\">0</span>][<span class=\"hljs-string\">&#x27;place_id&#x27;</span>] <span class=\"hljs-keyword\">as</span> <span class=\"hljs-built_in\">String</span>;\n    <span class=\"hljs-keyword\">return</span> placeId;\n  }\n</code></pre>\n<div class=\"info\">\n<p>ğŸ’¡ <strong>è£œå……ï¼š</strong></p>\n<p><a  href=\"https://pub.dev/packages/envied#usage\" target=\"_blank\" rel=\"noreferrer noopener\"><strong><code>envied</code></strong></a> v.s. <a  href=\"https://pub.dev/packages/flutter_dotenv\" target=\"_blank\" rel=\"noreferrer noopener\"><strong><code>flutter_dotenv</code></strong></a></p>\n<p>é€™å…©å€‹å¥—ä»¶éƒ½å¯ä»¥ç”¨ä¾†è™•ç† flutter ç’°å¢ƒè®Šæ•¸çš„éœ€æ±‚ï¼Œå·®åˆ¥æ˜¯ä½¿ç”¨ <code>env</code> æª”æ¡ˆçš„æ–¹å¼ï¼š</p>\n<ul>\n<li><strong><code>envied</code></strong><br />\ncode generation + ç¨‹å¼ç¢¼æ··æ·†åŠŸèƒ½ï¼Œå¯ä»¥è®“ API keys æ›´åŠ å®‰å…¨</li>\n<li><strong><code>flutter_dotenv</code></strong><br />\nå°‡ <code>env</code> åŠ å…¥ assets è³‡æ–™å¤¾ä¸­ï¼Œåœ¨ runtime æ™‚å€™è®€å–ï¼Œå› æ­¤æœ‰æ©Ÿæœƒå¯ä»¥å¾ APK ç²å– API keys</li>\n</ul>\n<p>å¦‚æœ <code>env</code> æ²’æ”¾ä»€éº¼é‡è¦çš„ keyï¼Œé‚£éº¼å…©å€‹å¥—ä»¶éƒ½å¯ä»¥ä½¿ç”¨ï¼Œåä¹‹ï¼Œå°±ç›´æ¥é¸æ“‡ <code>envied</code> äº†ã€‚</p>\n</div>\n<h3>å„ªé»</h3>\n<ul>\n<li>å®‰å…¨åº¦é«˜ (code obfuscation)</li>\n<li>API keys é›†ä¸­ç®¡ç†</li>\n<li>å¯æ”¯æŒå¤šå€‹ç’°å¢ƒè¨­å®š\n<blockquote>\n<p>å°šæœªè¦ªæ¸¬éï¼Œä½†æ ¹æ“šè©² <a  href=\"https://github.com/petercinibulk/envied/issues/16\" target=\"_blank\" rel=\"noreferrer noopener\">issue</a> è¨è«–ï¼Œä½œè€…å›æ‡‰æ˜¯å¯ä»¥åšå¾—åˆ°çš„ã€‚</p>\n</blockquote>\n</li>\n</ul>\n<h3>ç¼ºé»</h3>\n<ul>\n<li>\n<p>æ­¥é©Ÿæ¯”è¼ƒç¹è¤‡ï¼šå¢åŠ ç’°å¢ƒè®Šæ•¸æ™‚ï¼Œclass è¦æ‰‹å‹•æ–°å¢é …ç›®å’Œé‡æ–°ç”¢ <code>env.g.dart</code></p>\n<blockquote>\n<p>å› ç‚ºç­†è€…æ˜¯å¯«å‰ç«¯ï¼Œæ‰€ä»¥æ˜¯è·Ÿ web åšæ¯”è¼ƒï¼Œweb ä¹Ÿæ˜¯ç”¨ <code>.env</code> ç®¡ç†ç’°å¢ƒè®Šæ•¸ï¼Œæ–°å¢è®Šæ•¸æ™‚ï¼Œåªè¦é‡æ–° run å°ˆæ¡ˆï¼Œä¸éœ€è¦å†æ‰‹å‹•åšä»€éº¼äº†ã€‚</p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"ç¸½çµ\" title=\"ç¸½çµ\"><a href=\"#ç¸½çµ\">ç¸½çµ</a></h2>\n<p>å¦‚æœéœ€è¦æ¥ç¬¬ä¸‰æ–¹çš„ APIï¼Œéƒ½æœƒé‡åˆ°å¦‚ä½•åœ¨ client å»ç®¡ç†é€™äº› API Key çš„å•é¡Œï¼ŒåŸºæœ¬åªéœ€è¦è¬¹è¨˜é€™å…©é»ï¼Œå†ä¾è‡ªå·±éœ€æ±‚å»åšé¸æ“‡å³å¯ï¼š</p>\n<ul>\n<li>é‡è¦çš„ key æª”æ¡ˆï¼ŒåŠ å…¥ <code>.gitignore</code>ï¼Œä¸é€²ç‰ˆæ§</li>\n<li>release version éœ€è¦åšç¨‹å¼ç¢¼æ··æ·†(code obfuscation)</li>\n</ul>\n<p>å¦å¤–æœ‰äº›å¥—ä»¶æ˜¯éœ€è¦åˆ†åˆ¥åœ¨ Android å’Œ iOS çš„ <code>AndroidManifest.xml</code>ã€<code>AppDelegate.swift</code> å¯«å…¥ key å€¼ï¼Œä¾‹å¦‚ï¼š <a  href=\"https://codelabs.developers.google.com/codelabs/google-maps-in-flutter#3\" target=\"_blank\" rel=\"noreferrer noopener\">Google Maps</a>ï¼Œé€™æ™‚å€™å¯ä»¥è€ƒæ…®é¸æ“‡ <code>--dart-define</code>ï¼Œæ”¯æŒåªå®šç¾©ä¸€æ¬¡ keyï¼Œå°±è®“é›™å¹³å°å¯ä»¥å¾è¨­å®šæª”ä¸­è®€å–åˆ° keyï¼Œå¯ä»¥åƒè€ƒé€™ç¯‡æ–‡ç« çš„åšæ³• - <a  href=\"https://medium.com/flutter-community/how-to-setup-dart-define-for-keys-and-secrets-on-android-and-ios-in-flutter-apps-4f28a10c4b6c\" target=\"_blank\" rel=\"noreferrer noopener\">How to setup dart-define for keys and secrets on Android and iOS in Flutter apps</a>ã€‚</p>\n<h2 id=\"åƒè€ƒè³‡æ–™\" title=\"åƒè€ƒè³‡æ–™\"><a href=\"#åƒè€ƒè³‡æ–™\">åƒè€ƒè³‡æ–™</a></h2>\n<ol>\n<li><a  href=\"https://codewithandrea.com/articles/flutter-api-keys-dart-define-env-files/\" target=\"_blank\" rel=\"noreferrer noopener\">How to Store API Keys in Flutter: --dart-define vs .env files</a></li>\n<li><a  href=\"https://docs.flutter.dev/deployment/obfuscate\" target=\"_blank\" rel=\"noreferrer noopener\">Obfuscating Dart code</a></li>\n<li><a  href=\"https://www.dotenv.org/docs/security/env\" target=\"_blank\" rel=\"noreferrer noopener\">dotenv doc</a></li>\n</ol>\n","toc":{"title":"[Note] Flutter å¦‚ä½•éš±è— API Key","subtitles":["å‰è¨€","Hard-coding","â€“dart-define / --dart-define-from-file",".env æª”æ¡ˆå®šç¾© key","ç¸½çµ","åƒè€ƒè³‡æ–™"]}}